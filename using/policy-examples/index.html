<!DOCTYPE html>
<html lang="en-us" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.18.1" />
    <meta name="description" content="TFS Aggregator Documentation">
<meta name="author" content="TFS Aggregator Team">

    <link rel="shortcut icon" href="https://tfsaggregator.github.io/images/favicon.png" type="image/x-icon" />

    
    <title>Examples of Policies</title>
    <link href="https://tfsaggregator.github.io//css/nucleus.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/font-awesome.min.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/hybrid.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/featherlight.min.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/horsey.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/theme.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/hugo-theme.css" rel="stylesheet">
    <script src="https://tfsaggregator.github.io//js/jquery-2.x.min.js"></script>
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    

  </head>
  <body class="" data-url="/using/policy-examples/">
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <table style="border: none">
  <tr>
<td style="border: none">
<a id="logo" href="https://tfsaggregator.github.io/">
  <svg width="64pt" height="64pt" viewBox="0 0 256 256" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path fill="#67217a" d=" M 0.00 0.00 L 256.00 0.00 L 256.00 256.00 L 0.00 256.00 L 0.00 0.00 Z" />
  <path fill="#ffffff" d=" M 17.06 22.33 C 64.21 22.35 111.36 22.26 158.51 22.37 C 158.55 35.94 158.57 49.51 158.49 63.08 C 132.37 63.47 106.23 63.07 80.10 63.28 C 82.26 66.12 84.60 68.83 87.05 71.42 C 91.26 70.04 94.98 67.51 99.22 66.25 C 101.06 65.50 102.60 67.10 104.05 67.98 C 115.48 76.67 126.96 85.29 138.59 93.70 C 158.53 73.23 178.15 52.46 198.09 32.00 C 214.00 38.19 229.79 44.69 245.68 50.96 C 245.08 96.98 245.80 143.03 245.31 189.05 C 229.48 195.67 213.45 201.86 197.42 208.00 C 182.35 191.95 166.51 176.63 151.13 160.86 C 147.11 156.87 143.34 152.62 139.07 148.88 C 126.48 157.93 114.29 167.53 101.77 176.69 C 97.62 174.24 93.52 171.67 89.09 169.75 C 84.11 175.31 79.28 181.03 75.20 187.28 C 103.49 187.49 131.78 187.24 160.07 187.41 C 160.33 200.92 160.43 214.43 160.32 227.95 C 111.80 228.05 63.27 228.03 14.75 227.96 C 14.67 217.29 14.69 206.62 14.73 195.96 C 14.57 194.50 15.33 193.27 16.22 192.22 C 28.37 177.36 40.40 162.41 52.52 147.54 C 59.10 138.87 66.55 130.88 72.85 122.00 C 68.63 116.03 63.47 110.81 58.78 105.22 C 45.32 89.38 31.70 73.67 18.17 57.89 C 16.64 56.35 17.09 54.03 16.97 52.07 C 17.08 42.16 16.90 32.24 17.06 22.33 Z" />
  <path fill="#67217a" d=" M 24.90 30.93 C 67.15 30.90 109.40 30.76 151.65 31.00 C 151.68 38.75 151.69 46.51 151.65 54.26 C 121.70 54.50 91.74 54.23 61.79 54.39 C 70.37 64.79 79.23 74.97 88.07 85.14 C 93.20 83.35 97.74 80.27 102.78 78.28 C 114.68 87.58 126.41 97.13 138.64 105.98 C 157.56 87.44 175.94 68.33 195.00 49.92 C 206.84 54.51 218.61 59.27 230.37 64.06 C 230.43 101.98 230.50 139.90 230.34 177.82 C 219.78 182.24 209.08 186.30 198.51 190.70 C 196.92 191.24 194.69 192.47 193.43 190.68 C 175.17 172.40 156.94 154.09 138.63 135.88 C 126.38 144.79 114.64 154.38 102.66 163.65 C 97.99 161.68 93.69 158.93 89.00 157.05 C 87.45 157.70 86.56 159.27 85.44 160.45 C 75.66 172.62 65.70 184.64 55.93 196.81 C 88.46 197.08 121.00 196.63 153.53 197.04 C 153.55 204.68 153.55 212.33 153.53 219.98 C 109.78 220.29 66.01 220.15 22.26 220.05 C 22.21 214.68 22.21 209.30 22.20 203.93 C 22.28 202.33 22.04 200.50 23.30 199.28 C 43.25 174.88 63.09 150.38 83.04 125.97 C 83.99 124.77 84.88 123.53 85.77 122.28 C 67.61 100.77 49.17 79.49 30.93 58.04 C 28.97 55.65 26.59 53.53 25.09 50.80 C 24.50 44.20 24.95 37.55 24.90 30.93 Z" />
  <path fill="#ffffff" d=" M 157.63 120.97 C 169.84 111.17 182.27 101.63 194.68 92.07 C 194.73 111.34 194.75 130.61 194.67 149.88 C 182.33 140.23 169.87 130.73 157.63 120.97 Z" />
  <path fill="#ffffff" d=" M 102.11 100.26 C 105.75 102.38 108.43 105.69 111.41 108.59 C 115.46 112.73 119.70 116.68 123.61 120.96 C 119.83 125.06 115.77 128.89 111.86 132.87 C 108.73 135.96 105.82 139.35 102.10 141.77 C 102.76 139.96 103.55 138.19 104.78 136.69 C 109.18 131.18 113.80 125.86 118.09 120.26 C 112.85 113.54 106.10 107.85 102.11 100.26 Z" />
  </svg>
</a>
</td>
    <td style="border: none; text-align: left">
<div style="font-weight: 300">
  TFS Aggregator
</div>
    </td>
</tr>
</table>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input id="search-by" type="text" placeholder="Search">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="https://tfsaggregator.github.io//js/lunr.min.js"></script>
<script type="text/javascript" src="https://tfsaggregator.github.io//js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "https:\/\/tfsaggregator.github.io\/";
</script>
<script type="text/javascript" src="https://tfsaggregator.github.io//js/search.js"></script>

    
</div>


  <div class="highlightable">
    <ul class="topics">
      
      
        
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
      
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/intro/">
        <a href="https://tfsaggregator.github.io/intro/">
          <span>
            
              <b>1. </b>
            
             Introduction
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/intro/how-it-works/">
              <a href="https://tfsaggregator.github.io/intro/how-it-works/">
                <span>
                  
                  How it Works     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/intro/slack-coc/">
              <a href="https://tfsaggregator.github.io/intro/slack-coc/">
                <span>
                  
                  Code of Conduct     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  parent" data-nav-id="/using/">
        <a href="https://tfsaggregator.github.io/using/">
          <span>
            
              <b>2. </b>
            
             Users&#39; Guide
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/using/writing-rules/writing-rules/">
              <a href="https://tfsaggregator.github.io/using/writing-rules/writing-rules/">
                <span>
                  
                  Writing Rules and Policies     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/policy-syntax/">
              <a href="https://tfsaggregator.github.io/using/policy-syntax/">
                <span>
                  
                  Configuration XML syntax     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/scripting/">
              <a href="https://tfsaggregator.github.io/using/scripting/">
                <span>
                  
                  Scripting the Rules     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/object-model/">
              <a href="https://tfsaggregator.github.io/using/object-model/">
                <span>
                  
                  Objects Reference     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/objects-reference/self-object/">
              <a href="https://tfsaggregator.github.io/using/objects-reference/self-object/">
                <span>
                  
                    -&nbsp;
                  
                  self Object     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/objects-reference/field-object/">
              <a href="https://tfsaggregator.github.io/using/objects-reference/field-object/">
                <span>
                  
                    -&nbsp;
                  
                  Field Object     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/objects-reference/store-object/">
              <a href="https://tfsaggregator.github.io/using/objects-reference/store-object/">
                <span>
                  
                    -&nbsp;
                  
                  store Object     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/objects-reference/logger-object/">
              <a href="https://tfsaggregator.github.io/using/objects-reference/logger-object/">
                <span>
                  
                    -&nbsp;
                  
                  logger Object     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/objects-reference/library-objects/">
              <a href="https://tfsaggregator.github.io/using/objects-reference/library-objects/">
                <span>
                  
                    -&nbsp;
                  
                  Library Objects     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item active" data-nav-id="/using/policy-examples/">
              <a href="https://tfsaggregator.github.io/using/policy-examples/">
                <span>
                  
                  Examples of Policies     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/examples/auto-open-auto-close/">
              <a href="https://tfsaggregator.github.io/using/examples/auto-open-auto-close/">
                <span>
                  
                  Auto-Open and Auto-Close     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/examples/auto-create-children/">
              <a href="https://tfsaggregator.github.io/using/examples/auto-create-children/">
                <span>
                  
                  Auto-Create Children     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/scripting-tricks-n-tips/scripting-tricks-n-tips/">
              <a href="https://tfsaggregator.github.io/using/scripting-tricks-n-tips/scripting-tricks-n-tips/">
                <span>
                  
                  Tricks &amp; Tips     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/scripting-pitfalls/">
              <a href="https://tfsaggregator.github.io/using/scripting-pitfalls/">
                <span>
                  
                  Common Pitfalls     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/field-history/">
              <a href="https://tfsaggregator.github.io/using/field-history/">
                <span>
                  
                    -&nbsp;
                  
                  History field     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/upgrade-from-v1/">
              <a href="https://tfsaggregator.github.io/using/upgrade-from-v1/">
                <span>
                  
                  Upgrading from v1     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/admin/">
        <a href="https://tfsaggregator.github.io/admin/">
          <span>
            
              <b>3. </b>
            
             Administrator Guide
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/admin/install/">
              <a href="https://tfsaggregator.github.io/admin/install/">
                <span>
                  
                  Installing the Server Plugin     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/admin/install-webhooks/">
              <a href="https://tfsaggregator.github.io/admin/install-webhooks/">
                <span>
                  
                  Installing the Web Service     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/admin/console-app/">
              <a href="https://tfsaggregator.github.io/admin/console-app/">
                <span>
                  
                  Using the console to test Policies     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/admin/troubleshooting/">
              <a href="https://tfsaggregator.github.io/admin/troubleshooting/">
                <span>
                  
                  Troubleshooting     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/admin/security/">
              <a href="https://tfsaggregator.github.io/admin/security/">
                <span>
                  
                  Security     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/contrib/">
        <a href="https://tfsaggregator.github.io/contrib/">
          <span>
            
              <b>4. </b>
            
             Contributing
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/contrib/developer-intro/">
              <a href="https://tfsaggregator.github.io/contrib/developer-intro/">
                <span>
                  
                  Introduction to Contributors     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/contrib/source-code/">
              <a href="https://tfsaggregator.github.io/contrib/source-code/">
                <span>
                  
                  Source Code     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/contrib/local-build/">
              <a href="https://tfsaggregator.github.io/contrib/local-build/">
                <span>
                  
                  Local Build     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/contrib/debugging/">
              <a href="https://tfsaggregator.github.io/contrib/debugging/">
                <span>
                  
                  Debugging     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/contrib/continuous-integration/">
              <a href="https://tfsaggregator.github.io/contrib/continuous-integration/">
                <span>
                  
                  Continuous Integration     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
    </ul>
    <hr>
     
     <section id="contacts">
  <div style="padding-left: 1em; ">
    <a href="mailto:tfsaggregator@outlook.com"><i class="fa fa-envelope">&nbsp;</i>tfsaggregator@outlook.com</a>
    <br/>
    <a href="https://twitter.com/tfsaggregator"><i class="fa fa-twitter">&nbsp;</i>@tfsaggregator</a>
    <br/>
    <div style="padding-top: 4pt;">
    <a href="https://slackin-tfsaggregator.herokuapp.com/">
      <img alt="Slack Team Badge" src="https://slackin-tfsaggregator.herokuapp.com/badge.svg" />
    </a>
    </div>
  </div>
</section>
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>
    </section>
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
                
                
                
              <div id="top-github-link">
                  <a class="github-link" href="https://github.com/tfsaggregator/tfsaggregator-docs-hugo/edit/master/content/using/policy-examples.md" target="blank">
                    <i class="fa fa-code-fork"></i>
                    Edit this page
                  </a>
              </div>
                
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                <span id="toc-menu"><a href=""><i class="fa fa-list-alt"></i></a></span>
                
                
                
                
                  
                
                  
                
                  
                
                  
                
                  
                    
                    
                <a href="https://tfsaggregator.github.io/using/" itemprop="url"><span itemprop="title">Users&#39; Guide</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                <span itemprop="title"> Examples of Policies</span>
              </div>
              
                  <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#sample-polices">Sample polices</a></li>
<li><a href="#example-aggregations">Example Aggregations</a>
<ul>
<li><a href="#calculated-field">Calculated field</a></li>
<li><a href="#rollup-field-on-parent">Rollup field on parent</a></li>
</ul></li>
<li><a href="#pick-children-satisfying-condition">Pick children satisfying condition</a></li>
<li><a href="#using-linq-to-aggregate">Using Linq to Aggregate</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

              

            </div>
            
    	        <div id="body-inner">
                
                <h1>Examples of Policies</h1>
                



<h2 id="sample-polices">Sample polices</h2>

<p>The Unit tests use policy files from <code>UnitTests.Core\ConfigurationsForTests</code> folder, this are the most correct and tested. They do not show how to solve real world</p>

<p>The <code>samples\TFSAggregator2.ServerPlugin.policies</code> should be your <strong>starting point</strong>. This file contains a no-harm policy: it simply logs an &ldquo;<em>Hello, World</em>&rdquo; message when invoked. The comments remind the syntax.</p>

<p>From time to time, we test the policies contained in the <code>ManualTests</code> folder. They are good to learn but should not be trusted 100%, at least until we are able to setup automated integration testing.</p>

<h2 id="example-aggregations">Example Aggregations</h2>

<h3 id="calculated-field">Calculated field</h3>

<pre><code>&lt;rule name=&quot;Sum&quot; appliesTo=&quot;Task&quot; hasFields=&quot;Title,Description&quot;&gt;&lt;![CDATA[
    self[&quot;Estimated Work&quot;] = (double)self[&quot;Estimated Dev Work&quot;] + (double)self[&quot;Estimated Test Work&quot;];
]]&gt;&lt;/rule&gt;
</code></pre>

<p>This aggregation will total the values found in the Estimated Dev Work and Estimated Test Work fields for any Task work item.
The total will be placed in the Estimated Work field on the same work item as the source values were found.</p>

<p><img src="./calculated-field.png" alt="Calculated field in form" /></p>

<h3 id="rollup-field-on-parent">Rollup field on parent</h3>

<pre><code>&lt;rule name=&quot;Rollup&quot; hasFields=&quot;Estimated Dev Work;Estimated Test Work&quot;&gt;&lt;![CDATA[
  if (self.HasParent()) {
    self.Parent[&quot;Total Estimate&quot;] = (double)self.Parent[&quot;Estimated Dev Work&quot;] + (double)self[&quot;Estimated Test Work&quot;];
  }
]]&gt;&lt;/rule&gt;
</code></pre>

<p>This aggregation will total the values found in the Estimated Dev Work and Estimated Test Work fields for all Task work items on the parent.
The total will go in the Total Estimate field on the parent one level up from the Task (i.e. the direct parent).
In the Microsoft Visual Studio Scrum template that is always a Bug or Product Backlog Item.</p>

<blockquote>
<p><strong>Note on States</strong>: TFS has controls setup on State Transitions.
Most templates do not allow you to go directly from a New state to a Done state.</p>
</blockquote>

<h2 id="pick-children-satisfying-condition">Pick children satisfying condition</h2>

<pre><code>var child in self.Children.Where(
   child =&gt; child.Field.Any(
      field =&gt; field.ReferenceName == &quot;Custom.Product&quot;)
);
</code></pre>

<h2 id="using-linq-to-aggregate">Using Linq to Aggregate</h2>

<pre><code>&lt;rule name=&quot;RollupTask&quot; appliesTo=&quot;Task&quot;&gt;&lt;![CDATA[
if (self.HasParent())
{
    var parent = self.Parent;
    parent[&quot;Microsoft.VSTS.Scheduling.CompletedWork&quot;] = parent.Children.Sum(task =&gt; task.GetField&lt;double&gt;(&quot;Microsoft.VSTS.Scheduling.CompletedWork&quot;, 0d));
    parent[&quot;Microsoft.VSTS.Scheduling.RemainingWork&quot;] = parent.Children.Sum(task =&gt; task.GetField&lt;double&gt;(&quot;Microsoft.VSTS.Scheduling.RemainingWork&quot;, 0d));
    parent[&quot;Microsoft.VSTS.Scheduling.OriginalEstimate&quot;] = parent.Children.Sum(task =&gt; task.GetField&lt;double&gt;(&quot;Microsoft.VSTS.Scheduling.OriginalEstimate&quot;, 0d));
}
]]&gt;&lt;/rule&gt;
</code></pre>

<p>This rule updates a Product Backlog Item or Bug whenever any child Task is added or changes. The <em>Completed Work</em>, <em>Remaining Work</em> and <em>Original Estimate</em> on the parent become the sum of the corresponding fields of children Tasks.
Note that children Bug or Test Case do not update the parent.</p>


      
      </div>
          <div class="row">
          <div class="footer-panel">
<p>Last revision: January 12, 2017 | <a href="https://github.com/tfsaggregator/tfsaggregator-docs-hugo/commit/ae66422bd201a4d28b20bc78dc7e0b584181dceb">Fixed a number of errors in links to pictures and pages (ae66422)</a>
            <span style="float: right;">TFS Aggregator Documentation v2.3</span>
          </p>
          </div>
      </div>
    </div>

    <div id="navigation">
        
        <a class="nav nav-prev" href="https://tfsaggregator.github.io//using/objects-reference/library-objects/"> <i class="fa fa-chevron-left"></i></a>
        <a class="nav nav-next" href="https://tfsaggregator.github.io//using/scripting-tricks-n-tips" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://tfsaggregator.github.io//js/clipboard.min.js"></script>
    <script src="https://tfsaggregator.github.io//js/perfect-scrollbar.min.js"></script>
    <script src="https://tfsaggregator.github.io//js/perfect-scrollbar.jquery.min.js"></script>
    <script src="https://tfsaggregator.github.io//js/jquery.sticky-kit.min.js"></script>
    <script src="https://tfsaggregator.github.io//js/featherlight.min.js"></script>
    <script src="https://tfsaggregator.github.io//js/html5shiv-printshiv.min.js"></script>
    <script src="https://tfsaggregator.github.io//js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://tfsaggregator.github.io//js/modernizr.custom.71422.js"></script>
    <script src="https://tfsaggregator.github.io//js/learn.js"></script>
    <script src="https://tfsaggregator.github.io//js/hugo-learn.js"></script>
    

  </body>
</html>

