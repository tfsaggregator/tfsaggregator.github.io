<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This information does not apply to the Web Service version.
 Pre-requisites #  TFS #  The TFS Aggregator works with the following versions of TFS:
 TFS 2013 update 2,3,4,5 TFS 2015 RTM TFS 2015 update 1,2,3 TFS 2017 RTM TFS 2017 update 1  The installer will detect the correct TFS version and will install the appropriate binary. If you&rsquo;re upgrading, please uninstall your current TFS Aggregator version, upgrade TFS, then run the installer to automatically install the matching version."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Installing the Server Plugin"><meta property="og:description" content="This information does not apply to the Web Service version.
 Pre-requisites #  TFS #  The TFS Aggregator works with the following versions of TFS:
 TFS 2013 update 2,3,4,5 TFS 2015 RTM TFS 2015 update 1,2,3 TFS 2017 RTM TFS 2017 update 1  The installer will detect the correct TFS version and will install the appropriate binary. If you&rsquo;re upgrading, please uninstall your current TFS Aggregator version, upgrade TFS, then run the installer to automatically install the matching version."><meta property="og:type" content="article"><meta property="og:url" content="https://tfsaggregator.github.io/docs/v2/admin/install/"><meta property="article:modified_time" content="2021-06-12T13:16:19+01:00"><title>Installing the Server Plugin | Aggregator</title><link rel=manifest href=https://tfsaggregator.github.io/manifest.json><link rel=icon href=https://tfsaggregator.github.io/favicon.png type=image/x-icon><link rel=stylesheet href=https://tfsaggregator.github.io/book.min.b3215d9d1d18d9051e7fbe8f256ff80e30f41d29073b86348e230d297b771002.css integrity="sha256-syFdnR0Y2QUef76PJW/4DjD0HSkHO4Y0jiMNKXt3EAI="><script defer src=https://tfsaggregator.github.io/en.search.min.806e3d96617265ba96a1af820c08377d4d27e6c76a6e546a9be44435f1a18d01.js integrity="sha256-gG49lmFyZbqWoa+CDAg3fU0n5sdqblRqm+RENfGhjQE="></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=https://tfsaggregator.github.io/><span>Aggregator</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://tfsaggregator.github.io/docs/v3/>Aggregator 3 (CLI)</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/>Setup</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/azdo-authn/>Azure DevOps Personal Access Token</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/azure/>Azure CLI Setup</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/docker/>Docker configuration</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/production/>Production on Azure</a><ul></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/>CLI Commands</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/commands/common-options/>Common options</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/authentication-commands/>Authentication commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/instance-commands/>Instance commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/rule-commands/>Rule commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/map-commands/>Mapping commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/info-commands/>Informational commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/command-examples/>Examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/>Rules</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/rules/directives/>Directives</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/workitem/>WorkItem event objects</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/common-rule-objects/>Common objects</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-basic/>Basic examples</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-advanced/>Advanced examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/design/>Design</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/design/caveat/>Caveats</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/design/parallelism/>Parallelism</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/api/>REST API</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/troubleshoot/>Troubleshoot</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/contrib/>Contribute</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/contrib/pipelines/>Pipelines</a></li></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v2/>TFS Aggregator v2</a><ul><li><a href=https://tfsaggregator.github.io/docs/v2/intro/ class=collapsed>Introduction</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/ class=collapsed>Users' Guide</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/ class=collapsed>Administrator Guide</a><ul><li><a href=https://tfsaggregator.github.io/docs/v2/admin/install/ class=active>Installing the Server Plugin</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/install-webhooks/>Installing the Web Service</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/console-app/>Using the console to test Policies</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/logging/>Logging</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/troubleshooting/>Troubleshooting</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/support/>Support</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/security/>Security</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v2/contrib/ class=collapsed>Contributing</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/changelog/>Changelog</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://tfsaggregator.github.io/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Installing the Server Plugin</strong>
<label for=toc-control><img src=https://tfsaggregator.github.io/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#pre-requisites>Pre-requisites</a><ul><li><a href=#tfs->TFS</a></li><li><a href=#windows-event-log>Windows Event log</a></li><li><a href=#account-permissions>Account permissions</a></li></ul></li><li><a href=#automated-setup-using-windows-installer>Automated Setup using Windows Installer</a><ul><li><a href=#sample-install-scripts>Sample Install scripts</a></li></ul></li><li><a href=#configure>Configure</a></li><li><a href=#upgrade-tfs-to-a-new-version>Upgrade TFS to a new version</a></li><li><a href=#manual-setup>Manual Setup</a><ul><li><a href=#manual-install>Manual install</a></li><li><a href=#manual-uninstall>Manual Uninstall</a></li></ul></li></ul></nav></aside></header><article class=markdown><blockquote><p>This information does <strong>not</strong> apply to the Web Service version.</p></blockquote><h2 id=pre-requisites>Pre-requisites
<a class=anchor href=#pre-requisites>#</a></h2><h3 id=tfs->TFS
<a class=anchor href=#tfs->#</a></h3><p>The TFS Aggregator works with the following versions of TFS:</p><ul><li>TFS 2013 update 2,3,4,5</li><li>TFS 2015 RTM</li><li>TFS 2015 update 1,2,3</li><li>TFS 2017 RTM</li><li>TFS 2017 update 1</li></ul><p>The installer will detect the correct TFS version and will install the appropriate binary. If you&rsquo;re upgrading, please uninstall your current TFS Aggregator version, upgrade TFS, then run the installer to automatically install the matching version.</p><h3 id=windows-event-log>Windows Event log
<a class=anchor href=#windows-event-log>#</a></h3><p>The TFS Aggregator plugins writes to Windows Event log critical errors; the <strong>TFSAggregator</strong> Source must be defined in the Application log. The MSI takes care of this.</p><h3 id=account-permissions>Account permissions
<a class=anchor href=#account-permissions>#</a></h3><p>The TFS service account must have permissions to change your work items (on behalf of others if you have enabled impersonation).</p><h2 id=automated-setup-using-windows-installer>Automated Setup using Windows Installer
<a class=anchor href=#automated-setup-using-windows-installer>#</a></h2><p>Download TFSAggregator MSI file from the latest <a href=https://github.com/tfsaggregator/tfsaggregator/releases>Release</a>.</p><p>Unblock the downloaded file.</p><p><img src=./unblock-MSI.png alt></p><p>Launch the installer and accept the license</p><p><img src=./accept-license.png alt></p><p>The MSI packages all three Aggregator flavors, one for each supported TFS version.
The installer detects the TFS version installed and deploy the correct assemblies.</p><blockquote><p><strong>The installer detects automatically the TFS version: it fails if TFS is not present.</strong></p></blockquote><p><img src=./TFS-required.png alt="Error message when TFS is not installed"></p><p>It will install under <code>%ProgramFiles%</code>, typically <code>C:\Program Files\TFS Aggregator</code>, three folders: <code>bin</code>, <code>docs</code> and <code>samples</code>.
<img src=./program-files.png alt></p><p>Furthermore it installs the plugin in the proper directory — for TFS 2017 can be <code>C:\Program Files\Microsoft Team Foundation Server 15.0\Application Tier\Web Services\bin\Plugins</code> — the plugin assemblies and the default no-op Policy file <code>samples\TFSAggregator2.ServerPlugin.policies</code>.</p><blockquote><p><strong>An existing Policy file is not overwritten.</strong></p></blockquote><h3 id=sample-install-scripts>Sample Install scripts
<a class=anchor href=#sample-install-scripts>#</a></h3><p>In the <code>samples</code> folder you will find two Powershell scripts to install or remove Aggregator in case the TFS Administrator does not want (or can) use the MSI file.
The scripts require an elevated Powershell prompt.</p><h2 id=configure>Configure
<a class=anchor href=#configure>#</a></h2><p>To configure Aggregator you must add new rules in the policy file.</p><ol><li>Edit a copy of the sample <code>TFSAggregator2.ServerPlugin.policies</code> file.</li><li>Test your new policy using <code>TFSAggregator2.ConsoleApp.exe</code> command line tool</li><li>Copy the new file to the plugin folder; usually at this path for TFS 2017:
<code>C:\Program Files\Microsoft Team Foundation Server 15.0\Application Tier\Web Services\bin\Plugins</code></li><li>Verify that your new policy works; see <a href=https://tfsaggregator.github.io/admin/troubleshooting>TFS Aggregator Troubleshooting</a> in case of problems.</li></ol><p>See <a href=https://tfsaggregator.github.io/admin/console-app>Console Application</a> for more information on using the command line tool.</p><h2 id=upgrade-tfs-to-a-new-version>Upgrade TFS to a new version
<a class=anchor href=#upgrade-tfs-to-a-new-version>#</a></h2><p>Due to the fact that there have been breaking changes between TFS Server Object Model versions, there may be a need to fix the TFS aggregator after an upgrade.</p><p>When upgrading from/to specific versions, you need to uninstall TFS aggregator before upgrading the Application Tier server re-install it afterwards.</p><ul><li>TFS 2013 update 5</li><li>to TFS 2015 RTM</li><li>to TFS 2015 update 3</li><li>TFS 2015 RTM</li><li>to TFS 2015 update 3</li><li>to TFS 2017 RTM</li><li>to TFS 2017 update 1</li><li>TFS 2015 Update 3</li><li>to TFS 2017 RTM</li><li>to TFS 2017 update 1</li></ul><p>An uninstall+reinstall is required, repairing may not work. TFS will detect the incompatibility and will not load the plugin if the version mismatches.</p><h2 id=manual-setup>Manual Setup
<a class=anchor href=#manual-setup>#</a></h2><h3 id=manual-install>Manual install
<a class=anchor href=#manual-install>#</a></h3><ol><li>Download and extract the binaries from the latest release</li><li>Create <code>TFSAggregator2.ServerPlugin.policies</code> using one of the provides examples to build your actual policy.<ul><li>You will find the <a href=https://tfsaggregator.github.io/using/policy-syntax>complete syntax</a> and <a href=https://tfsaggregator.github.io/using/policy-examples>examples</a> following the links.</li></ul></li><li>Test your policy using <code>TFSAggregator2.ConsoleApp.exe</code> command line tool, see <a href=https://tfsaggregator.github.io/admin/troubleshooting>TFS Aggregator Troubleshooting</a>.</li><li>Register the EventLog source for TFS Aggregator, using an elevated Powershell prompt, by running<pre><code></code></pre></li></ol><p>New-EventLog -LogName &ldquo;Application&rdquo; -Source &ldquo;TFSAggregator&rdquo;
```
5. Copy <code>TFSAggregator2.ServerPlugin.dll</code>, <code>TFSAggregator2.Core.dll</code> and <code>TFSAggregator2.ServerPlugin.policies</code> to the plugin location on the Application Tier of your TFS Servers:
- The plugin folder is usually at this path for TFS 2017: <code>C:\Program Files\Microsoft Team Foundation Server 15.0\Application Tier\Web Services\bin\Plugins</code>;
- You must copy the exact same files on all TFS Application Tier servers.</p><p>TFS detects automatically that a file was copied in and will load it in.</p><p>You can verify if assembly version matches TFS version using this Powershell code</p><pre><code>$pathToAssemblyFile = &quot;C:\Program Files\Microsoft Team Foundation Server 15.0\Application Tier\Web Services\bin\Plugins\TFSAggregator2.ServerPlugin.dll&quot;
[System.Reflection.Assembly]::LoadFile($pathToAssemblyFile).GetCustomAttributesData() | ?{ $_.AttributeType -eq [System.Reflection.AssemblyConfigurationAttribute] } | select ConstructorArguments
</code></pre><h3 id=manual-uninstall>Manual Uninstall
<a class=anchor href=#manual-uninstall>#</a></h3><p>Remove the <code>TFSAggregator2.*</code> files from the plugin location on the Application Tier of your TFS Servers</p><p>The plugin folder is usually at this path:</p><ul><li>TFS 2015: <code>C:\Program Files\Microsoft Team Foundation Server 14.0\Application Tier\Web Services\bin\Plugins</code></li><li>TFS 2013: <code>C:\Program Files\Microsoft Team Foundation Server 12.0\Application Tier\Web Services\bin\Plugins</code></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/commit/98ff02656ce807065814dc5a01315f4e37f024f3 title="Last modified by Giulio Vian | June 12, 2021" target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/calendar.svg class=book-icon alt=Calendar>
<span>June 12, 2021</span></a></div><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/edit/master/content//docs/v2/admin/install/index.md target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#pre-requisites>Pre-requisites</a><ul><li><a href=#tfs->TFS</a></li><li><a href=#windows-event-log>Windows Event log</a></li><li><a href=#account-permissions>Account permissions</a></li></ul></li><li><a href=#automated-setup-using-windows-installer>Automated Setup using Windows Installer</a><ul><li><a href=#sample-install-scripts>Sample Install scripts</a></li></ul></li><li><a href=#configure>Configure</a></li><li><a href=#upgrade-tfs-to-a-new-version>Upgrade TFS to a new version</a></li><li><a href=#manual-setup>Manual Setup</a><ul><li><a href=#manual-install>Manual install</a></li><li><a href=#manual-uninstall>Manual Uninstall</a></li></ul></li></ul></nav></aside></main></body></html>