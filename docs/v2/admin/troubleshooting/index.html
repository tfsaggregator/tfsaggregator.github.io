<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="So you setup TFS Aggregator and it just sits there&mldr;. doing nothing&mldr;
Well, this is a check list of things to double check.
Server Plugin Checklist #   You are using it on a TFS 2013 update 2 or later server You installed the right version for your TFS server  You can verify if assembly version matches TFS version using this Powershell code    $pathToAssemblyFile = &#34;C:\Program Files\Microsoft Team Foundation Server 15."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Troubleshooting"><meta property="og:description" content="So you setup TFS Aggregator and it just sits there&mldr;. doing nothing&mldr;
Well, this is a check list of things to double check.
Server Plugin Checklist #   You are using it on a TFS 2013 update 2 or later server You installed the right version for your TFS server  You can verify if assembly version matches TFS version using this Powershell code    $pathToAssemblyFile = &#34;C:\Program Files\Microsoft Team Foundation Server 15."><meta property="og:type" content="article"><meta property="og:url" content="https://tfsaggregator.github.io/docs/v2/admin/troubleshooting/"><meta property="article:modified_time" content="2020-07-11T21:43:22+01:00"><title>Troubleshooting | Aggregator</title><link rel=manifest href=https://tfsaggregator.github.io/manifest.json><link rel=icon href=https://tfsaggregator.github.io/favicon.png type=image/x-icon><link rel=stylesheet href=https://tfsaggregator.github.io/book.min.b3215d9d1d18d9051e7fbe8f256ff80e30f41d29073b86348e230d297b771002.css integrity="sha256-syFdnR0Y2QUef76PJW/4DjD0HSkHO4Y0jiMNKXt3EAI="><script defer src=https://tfsaggregator.github.io/en.search.min.0fd7b9ca417654d7c89b5e26f6d9398920826afc007e965e91d8decea0bb3cd6.js integrity="sha256-D9e5ykF2VNfIm14m9tk5iSCCavwAfpZekdjezqC7PNY="></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=https://tfsaggregator.github.io/><span>Aggregator</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://tfsaggregator.github.io/docs/v3/>Aggregator CLI</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/>Setup</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/production/>Production</a><ul></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/>Commands</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/commands/command-examples/>Examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/>Rules</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-basic/>Basic examples</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-advanced/>Advanced examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/design/>Design</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/design/parallelism/>Parallelism</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/contrib/>Contribute</a><ul></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v2/>TFS Aggregator v2</a><ul><li><a href=https://tfsaggregator.github.io/docs/v2/intro/ class=collapsed>Introduction</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/ class=collapsed>Users' Guide</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/ class=collapsed>Administrator Guide</a><ul><li><a href=https://tfsaggregator.github.io/docs/v2/admin/install/>Installing the Server Plugin</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/install-webhooks/>Installing the Web Service</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/console-app/>Using the console to test Policies</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/logging/>Logging</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/troubleshooting/ class=active>Troubleshooting</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/support/>Support</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/security/>Security</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v2/contrib/ class=collapsed>Contributing</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/changelog/>Changelog</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://tfsaggregator.github.io/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Troubleshooting</strong>
<label for=toc-control><img src=https://tfsaggregator.github.io/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#server-plugin-checklist>Server Plugin Checklist</a></li><li><a href=#web-service-checklist>Web Service Checklist</a></li><li><a href=#policy--rules-checklist>Policy / Rules Checklist</a></li><li><a href=#use-console-application>Use Console Application</a></li></ul></nav></aside></header><article class=markdown><p>So you setup TFS Aggregator and it just sits there&mldr;. doing nothing&mldr;</p><p>Well, this is a check list of things to double check.</p><h2 id=server-plugin-checklist>Server Plugin Checklist
<a class=anchor href=#server-plugin-checklist>#</a></h2><ul><li>You are using it on a TFS 2013 update 2 or later server</li><li>You installed the right version for your TFS server<ul><li>You can verify if assembly version matches TFS version using this Powershell code</li></ul></li></ul><pre><code>$pathToAssemblyFile = &quot;C:\Program Files\Microsoft Team Foundation Server 15.0\Application Tier\Web Services\bin\Plugins\TFSAggregator2.ServerPlugin.dll&quot;
[System.Reflection.Assembly]::LoadFile($pathToAssemblyFile).GetCustomAttributesData() | ?{ $_.AttributeType -eq [System.Reflection.AssemblyConfigurationAttribute] } | select ConstructorArguments
</code></pre><ul><li>You copied the DLLs and the Policies file to the plugins location on all TFS Application Tier Servers (Usually at: <code>:\Program Files\Microsoft Team Foundation Server {version}\Application Tier\Web Services\bin\Plugins</code>)</li><li>You have given permission to the user running the plugin, e.g. add the &ldquo;TFS Service Account&rdquo; to the <strong>Project Collection Administrators</strong> TFS Group; if the user has not permission, you see a similar error in the Event Log of the TFS Server(s) <img src=./most-common-tfs30063.png alt></li><li>You may have to do this from the command line using <code>tfssecurity /collection:http://server:8080/tfs/DefaultCollection /g+ "Project Collection administrators" "LOCAL SERVICE"</code> if your service account is either LocalService, NetworkService or any other Windows Well-known identity, since they are no longer shown in the permission UI.</li><li>When using the Impersonation option, make sure the user executing the plugin (generally the TFS Service account) has the &ldquo;Make requests on behalf of others&rdquo; <a href=https://msdn.microsoft.com/en-us/library/ms252587.aspx>permission at the server level</a></li><li>If you upgraded your TFS and did not uninstall the TFS Aggregator before doing this TFS upgrade, the Aggregator does not work. Remove the TFS Aggregator from the TFS Program Files folder or run the uninstall of the TFS Aggegrator (backup your policies!). Then re-install the TFS Aggegrator setup or install manually for TFS 2015 or 2017 <a href=https://tfsaggregator.github.io/admin/install>as described here</a>. Every TFS version has its &ldquo;own&rdquo; assembly for the aggregator so it is important to use the right version against the right TFS.</li></ul><p>Also if you are having issues we recommend debugging your Policies file using <code>TFSAggregator2.ConsoleApp.exe</code> and trying that out (see below).</p><h2 id=web-service-checklist>Web Service Checklist
<a class=anchor href=#web-service-checklist>#</a></h2><p>As described in <a href=https://tfsaggregator.github.io/intro/how-it-works>How it Works</a> authentication goes both ways between TFS/VSTS and TFS Aggregator.</p><p><img src=https://tfsaggregator.github.io/intro/how-it-works/webservice-authentication.jpg alt="Web Service Authentication"></p><p>The call from VSTS to Web Service sends user and password in clear, protected by SSL, the values must match one entry of the Users section in Aggregator Web Service <code>web.config</code></p><pre><code>&lt;Users&gt;
    &lt;add key=&quot;user1&quot; value=&quot;password1&quot; /&gt;
&lt;/Users&gt;
</code></pre><p>This is not a real user (unless someone will offer Aggregator-as-a-Service), can be any printable string. I need it for two reasons:</p><ol><li>the Web Hooks configuration requires to enter some values and</li><li>you can control access to a single TFS Aggregator instance setting different users, per project or per account.</li></ol><p>The call from Aggregator Web Service to VSTS authenticates using a PAT issued by VSTS itself. Again, the PAT is listed in the policy to allow insulation between projects or accounts.</p><h2 id=policy--rules-checklist>Policy / Rules Checklist
<a class=anchor href=#policy--rules-checklist>#</a></h2><ul><li>You have updated a work item that triggers a rule. (The TFS Aggregation only works once a work item that has aggregation rules on it is updated. This may change in a future version.)</li><li>If the rule navigates between work items, work items have a proper Link (e.g. Parent-Child).</li><li>You have valid names for source and destination fields in <code>TFSAggregator2.ServerPlugin.policies</code>.</li><li>When you saved the policy file you saved it as UTF-8 encoding (in Notepad++ it is called “utf-8 without BOM”) (This should not be an issue, but it does not hurt to check).</li></ul><h2 id=use-console-application>Use Console Application
<a class=anchor href=#use-console-application>#</a></h2><p>The <code>TFSAggregator2.ConsoleApp.exe</code> command line tool is extremely useful to test and validate your policy files before applying to TFS.</p><p><strong>Sample invocation</strong></p><pre><code>TFSAggregator2.ConsoleApp.exe run --logLevel=diagnostic --policyFile=samples\TFSAggregator2.ServerPlugin.policies --teamProjectCollectionUrl=http://localhost:8080/tfs/DefaultCollection --teamProjectName=TfsAggregatorTest1 --workItemId=42
</code></pre><p>See <a href=https://tfsaggregator.github.io/admin/console-app>Console Application</a> for more information on using the command line tool.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/commit/59b03b4bd9444633c4cab890366a82833bb98f40 title="Last modified by Giulio Vian | July 11, 2020" target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/calendar.svg class=book-icon alt=Calendar>
<span>July 11, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/edit/master/content//docs/v2/admin/troubleshooting/index.md target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#server-plugin-checklist>Server Plugin Checklist</a></li><li><a href=#web-service-checklist>Web Service Checklist</a></li><li><a href=#policy--rules-checklist>Policy / Rules Checklist</a></li><li><a href=#use-console-application>Use Console Application</a></li></ul></nav></aside></main></body></html>