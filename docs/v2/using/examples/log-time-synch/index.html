<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This is an example of automation that allows keep consistency between Remaining Work and Completed Work for Task WI
General Flow:
 Remaining Work decreased (and Completed Work not changed) => then increase Completed Work accordingly Completed Work increased (and remainin Work not changed) => then decrease Remaining Work accordingly All other cases don&rsquo;t require any modifications as they are threated as re-estimation and should follow user decision  Process template: Agile or any template that has RemainingWork and CompletedWork fields for Task WI"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Remaining Work and Completed Work synchronization for Task WI"><meta property="og:description" content="This is an example of automation that allows keep consistency between Remaining Work and Completed Work for Task WI
General Flow:
 Remaining Work decreased (and Completed Work not changed) => then increase Completed Work accordingly Completed Work increased (and remainin Work not changed) => then decrease Remaining Work accordingly All other cases don&rsquo;t require any modifications as they are threated as re-estimation and should follow user decision  Process template: Agile or any template that has RemainingWork and CompletedWork fields for Task WI"><meta property="og:type" content="article"><meta property="og:url" content="https://tfsaggregator.github.io/docs/v2/using/examples/log-time-synch/"><meta property="article:modified_time" content="2020-08-31T09:37:30+02:00"><title>Remaining Work and Completed Work synchronization for Task WI | Aggregator</title><link rel=manifest href=https://tfsaggregator.github.io/manifest.json><link rel=icon href=https://tfsaggregator.github.io/favicon.png type=image/x-icon><link rel=stylesheet href=https://tfsaggregator.github.io/book.min.b3215d9d1d18d9051e7fbe8f256ff80e30f41d29073b86348e230d297b771002.css integrity="sha256-syFdnR0Y2QUef76PJW/4DjD0HSkHO4Y0jiMNKXt3EAI="><script defer src=https://tfsaggregator.github.io/en.search.min.94a8808a5458db4a7a736bbfe9ef45f82e38ce011fb3d781778fd81df04e4aa7.js integrity="sha256-lKiAilRY20p6c2u/6e9F+C44zgEfs9eBd4/YHfBOSqc="></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=https://tfsaggregator.github.io/><span>Aggregator</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://tfsaggregator.github.io/docs/v3/>Aggregator 3 (CLI)</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/>Setup</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/azdo-authn/>Azure DevOps Personal Access Token</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/azure/>Azure CLI Setup</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/production/>Azure Production</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/docker/>Docker configuration</a><ul></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/>CLI Commands</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/commands/common-options/>Common options</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/authentication-commands/>Authentication commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/instance-commands/>Instance commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/rule-commands/>Rule commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/map-commands/>Mapping commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/info-commands/>Informational commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/command-examples/>Examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/>Rules</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-basic/>Basic examples</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-advanced/>Advanced examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/design/>Design</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/design/parallelism/>Parallelism</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/api/>REST API</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/contrib/>Contribute</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/contrib/pipelines/>Pipelines</a></li></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v2/>TFS Aggregator v2</a><ul><li><a href=https://tfsaggregator.github.io/docs/v2/intro/ class=collapsed>Introduction</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/ class=collapsed>Users' Guide</a><ul><li><a href=https://tfsaggregator.github.io/docs/v2/using/writing-rules/writing-rules/>Writing Rules and Policies</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/policy-syntax/>Configuration XML syntax</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/scripting/>Scripting the Rules</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/objects-reference/>Objects Reference</a><ul><li><a href=https://tfsaggregator.github.io/docs/v2/using/objects-reference/self-object/>self Object</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/objects-reference/field-object/>Field Object</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/objects-reference/store-object/>store Object</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/objects-reference/logger-object/>logger Object</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/objects-reference/library-objects/>Library Objects</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/examples/>Examples of Policies</a><ul><li><a href=https://tfsaggregator.github.io/docs/v2/using/examples/accumulate-to-grand-parent/>Accumulate to grand-parent example</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/examples/auto-create-children/>Auto-Create Children example</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/examples/auto-open-auto-close/>Auto-Open and Auto-Close example</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/examples/log-time-synch/ class=active>Remaining Work and Completed Work synchronization for Task WI</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/examples/rollup/>Rollup examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/scripting-tricks-n-tips/scripting-tricks-n-tips/>Tricks & Tips</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/scripting-pitfalls/>Common Pitfalls</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/field-history/>History field</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/upgrade-from-v1/>Upgrading from v1</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/ class=collapsed>Administrator Guide</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/contrib/ class=collapsed>Contributing</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/changelog/>Changelog</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://tfsaggregator.github.io/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Remaining Work and Completed Work synchronization for Task WI</strong>
<label for=toc-control><img src=https://tfsaggregator.github.io/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents></nav></aside></header><article class=markdown><p>This is an example of automation that allows keep consistency between Remaining Work and Completed Work for Task WI</p><p>General Flow:</p><ol><li>Remaining Work decreased (and Completed Work not changed) => then increase Completed Work accordingly</li><li>Completed Work increased (and remainin Work not changed) => then decrease Remaining Work accordingly</li><li>All other cases don&rsquo;t require any modifications as they are threated as re-estimation and should follow user decision</li></ol><p>Process template: Agile or any template that has RemainingWork and CompletedWork fields for Task WI</p><p><strong>Impersonation in configuration for TFS aggregator should be turned Off to be able identify Real User actions and TFS Aggregator created ones</strong></p><p><strong>TFSAutomation - should be updated with your user name under which TFS Aggregator is running.</strong></p><pre><code>&lt;authentication autoImpersonate=&quot;false&quot; /&gt;
</code></pre><pre><code>    &lt;rule name=&quot;LogTimeSynch&quot; appliesTo=&quot;Task&quot; hasFields=&quot;Microsoft.VSTS.Scheduling.RemainingWork,Microsoft.VSTS.Scheduling.CompletedWork&quot; changes=&quot;Change&quot;&gt;
        &lt;![CDATA[
	     var lastRevisionWI = self.LastRevision; 		
		 var lastChangedBy = self.Fields[&quot;System.ChangedBy&quot;].OriginalValue;
		 logger.Log(&quot;This item was before changed by {0}&quot;,(string)lastChangedBy);

 			 //Verify that this change was done by User not an Automation Bot under which TFS Aggregator is running (Impersonation should be turned off in order to face this behavior)
		 	 if ((string)lastChangedBy != &quot;TFSAutomation&quot;)
			  {  
			   // Verify which values were changed: Remaining Time or Completed Time
			   
			   var PrevValueRemaining = 0.0;
			   var PrevValueComplete = 0.0;
			   
			   //verify work fields aren't null
			   if (lastRevisionWI.Fields[&quot;Microsoft.VSTS.Scheduling.RemainingWork&quot;].OriginalValue != null)
			    {
				 PrevValueRemaining = (double)lastRevisionWI.Fields[&quot;Microsoft.VSTS.Scheduling.RemainingWork&quot;].OriginalValue;
				}
				
			   if (lastRevisionWI.Fields[&quot;Microsoft.VSTS.Scheduling.CompletedWork&quot;].OriginalValue != null)
			    {
				 PrevValueComplete = (double)lastRevisionWI.Fields[&quot;Microsoft.VSTS.Scheduling.CompletedWork&quot;].OriginalValue;
				}
					  
			   var CurrentValueRemaining =  (double)(self[&quot;Microsoft.VSTS.Scheduling.RemainingWork&quot;] ?? 0d); 
			   var CurrentValueComplete =  (double)(self[&quot;Microsoft.VSTS.Scheduling.CompletedWork&quot;] ?? 0d);
				  
			   var RemainingDiff = (double)PrevValueRemaining - (double)CurrentValueRemaining;
			   var CompletedDiff = (double)PrevValueComplete - (double)CurrentValueComplete;

			   logger.Log(&quot;Prev Remaining is {0}&quot;, PrevValueRemaining); 
			   logger.Log(&quot;Current Remaining is {0}&quot;, CurrentValueRemaining); 
			   logger.Log(&quot;Remaining Diff is {0}&quot;, RemainingDiff); 

			   logger.Log(&quot;Prev Complete is {0}&quot;, PrevValueComplete); 
			   logger.Log(&quot;Current Complete is {0}&quot;, CurrentValueComplete); 
			   logger.Log(&quot;Complete Diff is {0}&quot;, CompletedDiff); 
			  
			   // process case when Remaining time was decreased so that Completed Time should be increased accordingly
			   if (RemainingDiff &gt; 0 &amp;&amp; CompletedDiff == 0)
			    { 
				 self[&quot;Microsoft.VSTS.Scheduling.CompletedWork&quot;] = (double)PrevValueComplete + (double)RemainingDiff;
			    }
			   // process case when Completed Time was increased so that Remaining Time should be decreased accordingly 
			   if (RemainingDiff == 0 &amp;&amp; CompletedDiff &lt; 0)
			    { 
				 if ((double)PrevValueRemaining + (double)CompletedDiff &lt; 0)
				  {
				   self[&quot;Microsoft.VSTS.Scheduling.RemainingWork&quot;] = 0.0;
				  }
				 else
				  {
				   self[&quot;Microsoft.VSTS.Scheduling.RemainingWork&quot;] = (double)PrevValueRemaining + (double)CompletedDiff;
				  }
			    }
			   //all other cases means reestimation so that no changes should be applied by Bot
		      }
		     else
		      {
			   logger.Log(&quot;Changed by TFSAutomation user, stop processing&quot;);
		      }
			
		]]&gt;
    &lt;/rule&gt;
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/commit/6a7f7214076ec3595b62f5c58a16817466dbf3b3 title="Last modified by Giulio Vian | August 31, 2020" target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/calendar.svg class=book-icon alt=Calendar>
<span>August 31, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/edit/master/content//docs/v2/using/examples/log-time-synch.md target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents></nav></aside></main></body></html>