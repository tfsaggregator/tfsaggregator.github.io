<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Azure Resource Names #  Aggregator CLI has three ways of generating names for Azure Resources. Keep in mind, that Azure Function App and Storage resources must have unique names in Azure.
Basic template #  This template is used when you do not specify the --resourceGroup option.
In this scenario Aggregator tries to create an Azure Resource Group for each instance. The name of the resource group derives from the instance name."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Instance commands"><meta property="og:description" content="Azure Resource Names #  Aggregator CLI has three ways of generating names for Azure Resources. Keep in mind, that Azure Function App and Storage resources must have unique names in Azure.
Basic template #  This template is used when you do not specify the --resourceGroup option.
In this scenario Aggregator tries to create an Azure Resource Group for each instance. The name of the resource group derives from the instance name."><meta property="og:type" content="article"><meta property="og:url" content="https://tfsaggregator.github.io/docs/v3/commands/instance-commands/"><meta property="article:modified_time" content="2020-09-18T10:29:23+02:00"><title>Instance commands | Aggregator</title><link rel=manifest href=https://tfsaggregator.github.io/manifest.json><link rel=icon href=https://tfsaggregator.github.io/favicon.png type=image/x-icon><link rel=stylesheet href=https://tfsaggregator.github.io/book.min.b3215d9d1d18d9051e7fbe8f256ff80e30f41d29073b86348e230d297b771002.css integrity="sha256-syFdnR0Y2QUef76PJW/4DjD0HSkHO4Y0jiMNKXt3EAI="><script defer src=https://tfsaggregator.github.io/en.search.min.0a891897870684ae33f9f4930335dce5d374a3a858bb75abfaa5268f860aba5a.js integrity="sha256-CokYl4cGhK4z+fSTAzXc5dN0o6hYu3Wr+qUmj4YKulo="></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=https://tfsaggregator.github.io/><span>Aggregator</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://tfsaggregator.github.io/docs/v3/>Aggregator 3 (CLI)</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/>Setup</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/azdo-authn/>Azure DevOps Personal Access Token</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/azure/>Azure CLI Setup</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/docker/>Docker configuration</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/production/>Production on Azure</a><ul></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/>CLI Commands</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/commands/common-options/>Common options</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/authentication-commands/>Authentication commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/instance-commands/ class=active>Instance commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/rule-commands/>Rule commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/map-commands/>Mapping commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/info-commands/>Informational commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/command-examples/>Examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/>Rules</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/rules/directives/>Directives</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/workitem/>WorkItem event objects</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/common-rule-objects/>Common objects</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-basic/>Basic examples</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-advanced/>Advanced examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/design/>Design</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/design/parallelism/>Parallelism</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/api/>REST API</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/contrib/>Contribute</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/contrib/pipelines/>Pipelines</a></li></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v2/>TFS Aggregator v2</a><ul><li><a href=https://tfsaggregator.github.io/docs/v2/intro/ class=collapsed>Introduction</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/ class=collapsed>Users' Guide</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/ class=collapsed>Administrator Guide</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/contrib/ class=collapsed>Contributing</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/changelog/>Changelog</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://tfsaggregator.github.io/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Instance commands</strong>
<label for=toc-control><img src=https://tfsaggregator.github.io/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#azure-resource-names>Azure Resource Names</a><ul><li><a href=#basic-template>Basic template</a></li><li><a href=#default-template>Default template</a></li><li><a href=#custom-template>Custom template</a></li></ul></li><li><a href=#github-cache>GitHub cache</a></li><li><a href=#installinstance>install.instance</a></li><li><a href=#configureinstance>configure.instance</a></li><li><a href=#updateinstance>update.instance</a></li><li><a href=#uninstallinstance>uninstall.instance</a></li></ul></nav></aside></header><article class=markdown><h2 id=azure-resource-names>Azure Resource Names
<a class=anchor href=#azure-resource-names>#</a></h2><p>Aggregator CLI has three ways of generating names for Azure Resources.
Keep in mind, that Azure Function App and Storage resources must have unique names in Azure.</p><h3 id=basic-template>Basic template
<a class=anchor href=#basic-template>#</a></h3><p>This template is used when you <strong>do not</strong> specify the <code>--resourceGroup</code> option.</p><p>In this scenario Aggregator tries to create an Azure Resource Group for each instance.
The name of the resource group derives from the instance name.</p><table><thead><tr><th>Object</th><th>Generated name</th></tr></thead><tbody><tr><td>Instance Name</td><td><code>foo</code></td></tr><tr><td>Resource Group</td><td><code>aggregator-foo</code></td></tr><tr><td>StorageAccount</td><td><code>aggregator</code>######## (8 random characters)</td></tr><tr><td>Function App</td><td><code>fooaggregator</code></td></tr><tr><td>Hosting Plan</td><td><code>fooaggregator-plan</code></td></tr><tr><td>AppInsight</td><td><code>fooaggregator-ai</code></td></tr></tbody></table><h3 id=default-template>Default template
<a class=anchor href=#default-template>#</a></h3><p>This template is used when you specify the <code>--resourceGroup</code> option</p><table><thead><tr><th>Object</th><th>Generated name</th></tr></thead><tbody><tr><td>Instance Name</td><td><code>foo</code></td></tr><tr><td>Resource Group</td><td><code>bar</code></td></tr><tr><td>StorageAccount</td><td><code>aggregator</code>######## (8 random characters)</td></tr><tr><td>Function App</td><td><code>fooaggregator</code></td></tr><tr><td>Hosting Plan</td><td><code>fooaggregator-plan</code></td></tr><tr><td>AppInsight</td><td><code>fooaggregator-ai</code></td></tr></tbody></table><p>In this scenario, you can have more than one Instance (Azure Function) in the same Resource Group.</p><h3 id=custom-template>Custom template
<a class=anchor href=#custom-template>#</a></h3><p>This template allows a complete customisation of the generated names.
You specify both <code>--namingTemplate</code> and <code>--resourceGroup</code> options.</p><p>Given a custom template with this data</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;ResourceGroupPrefix&#34;</span>: <span style=color:#e6db74>&#34;rgp-&#34;</span>,
  <span style=color:#f92672>&#34;ResourceGroupSuffix&#34;</span>: <span style=color:#e6db74>&#34;-rgs&#34;</span>,
  <span style=color:#f92672>&#34;FunctionAppPrefix&#34;</span>: <span style=color:#e6db74>&#34;p&#34;</span>,
  <span style=color:#f92672>&#34;FunctionAppSuffix&#34;</span>: <span style=color:#e6db74>&#34;s&#34;</span>,
  <span style=color:#f92672>&#34;HostingPlanPrefix&#34;</span>: <span style=color:#e6db74>&#34;hp-&#34;</span>,
  <span style=color:#f92672>&#34;HostingPlanSuffix&#34;</span>: <span style=color:#e6db74>&#34;-hs&#34;</span>,
  <span style=color:#f92672>&#34;AppInsightPrefix&#34;</span>: <span style=color:#e6db74>&#34;aip-&#34;</span>,
  <span style=color:#f92672>&#34;AppInsightSuffix&#34;</span>: <span style=color:#e6db74>&#34;-ais&#34;</span>,
  <span style=color:#f92672>&#34;StorageAccountPrefix&#34;</span>: <span style=color:#e6db74>&#34;strg&#34;</span>,
  <span style=color:#f92672>&#34;StorageAccountSuffix&#34;</span>: <span style=color:#e6db74>&#34;123456&#34;</span>
}
</code></pre></div><p>you have</p><table><thead><tr><th>Object</th><th>Generated name</th></tr></thead><tbody><tr><td>Instance Name</td><td><code>foo</code></td></tr><tr><td>Resource Group</td><td><code>rgp-bar-rgs</code></td></tr><tr><td>StorageAccount</td><td><code>strgfoo123456</code></td></tr><tr><td>Function App</td><td><code>pfoos</code></td></tr><tr><td>Hosting Plan</td><td><code>hp-foo-hs</code></td></tr><tr><td>AppInsight</td><td><code>aip-foo-ais</code></td></tr></tbody></table><h2 id=github-cache>GitHub cache
<a class=anchor href=#github-cache>#</a></h2><p>Aggregator CLI caches GitHub data for 24 hours to prevent <em>API rate limit exceeded</em> error. If CLI fails to find a specific version, check that it is still available in GitHub and delete the <code>githubresponse.cache</code> file in the <code>%LOCALAPPDATA%\aggregator-cli</code> (Windows) or <code>$HOME/.local/share/aggregator-cli</code> directory (Linux).</p><p>This cache applies to both <code>install.instance</code> and <code>update.instance</code> commands.</p><h2 id=installinstance>install.instance
<a class=anchor href=#installinstance>#</a></h2><p>Creates a new Aggregator instance in Azure. It requires two mandatory options.</p><table><thead><tr><th>Option</th><th align=center>Short form</th><th>Description</th></tr></thead><tbody><tr><td><code>--name</code></td><td align=center><code>-n</code></td><td>The name for the new Aggregator instance.</td></tr><tr><td><code>--location</code></td><td align=center><code>-l</code></td><td>Name of Azure region that will host the Aggregator instance.</td></tr></tbody></table><p>This command creates a few resources in Azure:</p><ul><li>An Azure Function App that will host the Rule Engine and receive the notifications from Azure DevOps.</li><li>The associated Hosting Plan.</li><li>A Storage account to support the Function App.</li><li>An AppInsight instance to store the traces and messages generated by the Rules.</li></ul><p>After the required Azure Resources are in place, it downloads the latest Aggregator Runtime from GitHub and uploads it so it is shared by future added Rules.</p><p>The overall process may require a few minutes. It is a good practice to set the <code>--verbose</code> option to track the progress.</p><p>If the process fails, the resources create are still in Azure. You can try re-run the command after fixing the failing step.</p><p>You can refine the process with additional options.</p><table><thead><tr><th>Option</th><th align=center>Short form</th><th>Description</th></tr></thead><tbody><tr><td><code>--resourceGroup</code></td><td align=center><code>-g</code></td><td>Azure Resource Group that contains the Aggregator instances. If you specify this option, the Resource Group must already exists and the logon account must be a Contributor.</td></tr><tr><td><code>--namingTemplate</code></td><td align=center>n/a</td><td>Specify affixes for all Azure resources that will be created. This option requires defining <code>--resourceGroup</code>, also. This turns off automatic name generation and allow comply with enterprise requirements.</td></tr><tr><td><code>--requiredVersion</code></td><td align=center>n/a</td><td>Version of Aggregator Runtime required. This is mutually exclusive with <code>--sourceUrl</code>. The matching version is retrieved from GitHub and uploaded to the Azure Function App. The version number must match one of the <a href=https://github.com/tfsaggregator/aggregator-cli/releases>Aggregator releases</a> in GitHub. Note that <a href=#github-cache>GitHub caching</a> applies.</td></tr><tr><td><code>--sourceUrl</code></td><td align=center>n/a</td><td>URL of Aggregator Runtime. This is mutually exclusive with <code>--requiredVersion</code>. It should be used in enterprise scenario where the CLI cannot read from GitHub. It supports <code>http</code>, <code>https</code> and <code>file</code> scheme, so you can download the Runtime on a network share.</td></tr><tr><td><code>--hostingPlanTier</code></td><td align=center><code>-t</code></td><td>Azure AppPlan Service tier hosting the Aggregator instances. Defaults to <code>Dynamic</code>.</td></tr><tr><td><code>--hostingPlanSku</code></td><td align=center><code>-k</code></td><td>Azure AppPlan SKU hosting the Aggregator instances. Defaults to <code>Y1</code>, matching the <em>Dynamic</em> tier.</td></tr><tr><td><code>--appInsightLocation</code></td><td align=center>n/a</td><td>Name of Azure region that will host AppInsight for the new Aggregator instance. This allows to host the Function App in a region where AppInsight is not available.</td></tr></tbody></table><h2 id=configureinstance>configure.instance
<a class=anchor href=#configureinstance>#</a></h2><p>Reconfigures an existing Aggregator instance. It requires two mandatory options.</p><table><thead><tr><th>Option</th><th align=center>Short form</th><th>Description</th></tr></thead><tbody><tr><td><code>--name</code></td><td align=center><code>-n</code></td><td>The name of an existing Aggregator instance.</td></tr><tr><td><code>--location</code></td><td align=center><code>-l</code></td><td>Name of Azure region hosting the Aggregator instance.</td></tr></tbody></table><p>You can use these two options to further specify the name.</p><table><thead><tr><th>Option</th><th align=center>Short form</th><th>Description</th></tr></thead><tbody><tr><td><code>--resourceGroup</code></td><td align=center><code>-g</code></td><td>Azure Resource Group that contains the Aggregator instance.</td></tr><tr><td><code>--namingTemplate</code></td><td align=center>n/a</td><td>Specify affixes for Azure resources. This option requires defining <code>--resourceGroup</code>, also. This turns off automatic name generation and allow comply with enterprise requirements.</td></tr></tbody></table><p>Furthermore, you must specify one of these two options.</p><table><thead><tr><th>Option</th><th align=center>Short form</th><th>Description</th></tr></thead><tbody><tr><td><code>--authentication</code></td><td align=center><code>-a</code></td><td>Refresh the Azure DevOps authentication data saved in the Function App configuration.</td></tr><tr><td><code>--saveMode</code></td><td align=center><code>-m</code></td><td>Sets the algorithm to save the data changed by Rules back to Azure DevOps.</td></tr></tbody></table><h2 id=updateinstance>update.instance
<a class=anchor href=#updateinstance>#</a></h2><p>Updates an existing Aggregator instance in Azure, with latest runtime binaries. It requires one mandatory options.</p><table><thead><tr><th>Option</th><th align=center>Short form</th><th>Description</th></tr></thead><tbody><tr><td><code>--instance</code></td><td align=center><code>-i</code></td><td>The name of an existing Aggregator instance.</td></tr></tbody></table><p>You can use these two options to further specify the name.</p><table><thead><tr><th>Option</th><th align=center>Short form</th><th>Description</th></tr></thead><tbody><tr><td><code>--resourceGroup</code></td><td align=center><code>-g</code></td><td>Azure Resource Group that contains the Aggregator instance.</td></tr><tr><td><code>--namingTemplate</code></td><td align=center>n/a</td><td>Specify affixes for Azure resources. This option requires defining <code>--resourceGroup</code>, also. This turns off automatic name generation and allow comply with enterprise requirements.</td></tr></tbody></table><p>Furthermore, you must specify one of these two options to identify the Runtime version you want to upgrade to.</p><table><thead><tr><th>Option</th><th align=center>Short form</th><th>Description</th></tr></thead><tbody><tr><td><code>--requiredVersion</code></td><td align=center>n/a</td><td>Version of Aggregator Runtime required. This is mutually exclusive with <code>--sourceUrl</code>. The matching version is retrieved from GitHub and uploaded to the Azure Function App. The version number must match one of the <a href=https://github.com/tfsaggregator/aggregator-cli/releases>Aggregator releases</a> in GitHub. Note that <a href=#github-cache>GitHub caching</a> applies.</td></tr><tr><td><code>--sourceUrl</code></td><td align=center>n/a</td><td>URL of Aggregator Runtime. This is mutually exclusive with <code>--requiredVersion</code>. It should be used in enterprise scenario where the CLI cannot read from GitHub. It supports <code>http</code>, <code>https</code> and <code>file</code> scheme, so you can download the Runtime on a network share.</td></tr></tbody></table><h2 id=uninstallinstance>uninstall.instance
<a class=anchor href=#uninstallinstance>#</a></h2><p>Destroys an Aggregator instance in Azure, that is the Azure Function App created by <a href=#installinstance><code>install.instance</code></a>. It requires two mandatory options.</p><table><thead><tr><th>Option</th><th align=center>Short form</th><th>Description</th></tr></thead><tbody><tr><td><code>--name</code></td><td align=center><code>-n</code></td><td>The name of an existing Aggregator instance.</td></tr><tr><td><code>--location</code></td><td align=center><code>-l</code></td><td>Name of Azure region hosting the Aggregator instance.</td></tr></tbody></table><p>You can use these two options to further specify the operation.</p><table><thead><tr><th>Option</th><th align=center>Short form</th><th>Description</th></tr></thead><tbody><tr><td><code>--resourceGroup</code></td><td align=center><code>-g</code></td><td>Azure Resource Group that contains the Aggregator instance.</td></tr><tr><td><code>--namingTemplate</code></td><td align=center>n/a</td><td>Specify affixes for Azure resources. This option requires defining <code>--resourceGroup</code>, also. This turns off automatic name generation and allow comply with enterprise requirements.</td></tr><tr><td><code>--dont-remove-mappings</code></td><td align=center><code>-m</code></td><td>Do not remove mappings from Azure DevOps (default is to remove them).</td></tr></tbody></table><p>The Resource Group is deleted only if it was created by Aggregator.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/commit/8cd5c63201a99aa1bd1ec70dcf936b69b0ad308c title="Last modified by Giulio Vian | September 18, 2020" target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/calendar.svg class=book-icon alt=Calendar>
<span>September 18, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/edit/master/content//docs/v3/commands/instance-commands.md target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#azure-resource-names>Azure Resource Names</a><ul><li><a href=#basic-template>Basic template</a></li><li><a href=#default-template>Default template</a></li><li><a href=#custom-template>Custom template</a></li></ul></li><li><a href=#github-cache>GitHub cache</a></li><li><a href=#installinstance>install.instance</a></li><li><a href=#configureinstance>configure.instance</a></li><li><a href=#updateinstance>update.instance</a></li><li><a href=#uninstallinstance>uninstall.instance</a></li></ul></nav></aside></main></body></html>