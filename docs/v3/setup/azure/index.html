<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Setup for Aggregator CLI #  Prerequisites #  We developed and tested Aggregator on Windows 10 and presumably it works fine on Windows Server 2019. The integration tests runs on Ubuntu so CLI works on Ubuntu too. If you find that works on different operating systems, let us know.
To use Aggregator you need three things:
 Access to an Azure DevOps Services Organization (or at least a Project) a Personal Access Token with sufficient permissions on the Organization or Project Access to an Azure Subscription (or at least a Resource Group) a Service Principal with, at least, Contributor permission on a Resource Group of the Subscription ."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Azure CLI Setup"><meta property="og:description" content="Aggregator Documentation"><meta property="og:type" content="website"><meta property="og:url" content="https://tfsaggregator.github.io/docs/v3/setup/azure/"><title>Azure CLI Setup | Aggregator</title><link rel=manifest href=https://tfsaggregator.github.io/manifest.json><link rel=icon href=https://tfsaggregator.github.io/favicon.png type=image/x-icon><link rel=stylesheet href=https://tfsaggregator.github.io/book.min.b3215d9d1d18d9051e7fbe8f256ff80e30f41d29073b86348e230d297b771002.css integrity="sha256-syFdnR0Y2QUef76PJW/4DjD0HSkHO4Y0jiMNKXt3EAI="><script defer src=https://tfsaggregator.github.io/en.search.min.b2b260425a57b8f86604d5563d29a733c0f67fabe2b119e06b273500421bd117.js integrity="sha256-srJgQlpXuPhmBNVWPSmnM8D2f6visRngayc1AEIb0Rc="></script><link rel=alternate type=application/rss+xml href=https://tfsaggregator.github.io/docs/v3/setup/azure/index.xml title=Aggregator></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=https://tfsaggregator.github.io/><span>Aggregator</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://tfsaggregator.github.io/docs/v3/>Aggregator 3 (CLI)</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/>Setup</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/azdo-authn/>Azure DevOps Personal Access Token</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/azure/ class=active>Azure CLI Setup</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/docker/>Docker configuration</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/production/>Production on Azure</a><ul></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/>CLI Commands</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/commands/common-options/>Common options</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/authentication-commands/>Authentication commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/instance-commands/>Instance commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/rule-commands/>Rule commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/map-commands/>Mapping commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/info-commands/>Informational commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/command-examples/>Examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/>Rules</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/rules/directives/>Directives</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/workitem/>WorkItem event objects</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/common-rule-objects/>Common objects</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-basic/>Basic examples</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-advanced/>Advanced examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/design/>Design</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/design/caveat/>Caveats</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/design/parallelism/>Parallelism</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/api/>REST API</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/troubleshoot/>Troubleshoot</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/contrib/>Contribute</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/contrib/pipelines/>Pipelines</a></li></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v2/>TFS Aggregator v2</a><ul><li><a href=https://tfsaggregator.github.io/docs/v2/intro/ class=collapsed>Introduction</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/ class=collapsed>Users' Guide</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/ class=collapsed>Administrator Guide</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/contrib/ class=collapsed>Contributing</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/changelog/>Changelog</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://tfsaggregator.github.io/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Azure CLI Setup</strong>
<label for=toc-control><img src=https://tfsaggregator.github.io/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#how-to-create-an-azure-service-principal>How to create an Azure Service Principal</a><ul><li><a href=#assign-permissions-to-service-principal>Assign permissions to Service Principal</a></li></ul></li><li><a href=#azure-devops-personal-access-token-pat>Azure DevOps Personal Access Token (PAT)</a></li><li><a href=#get-the-executable>Get the executable</a></li></ul></nav></aside></header><article class=markdown><h1 id=setup-for-aggregator-cli>Setup for Aggregator CLI
<a class=anchor href=#setup-for-aggregator-cli>#</a></h1><h2 id=prerequisites>Prerequisites
<a class=anchor href=#prerequisites>#</a></h2><p>We developed and tested Aggregator on Windows 10 and presumably it works fine on Windows Server 2019. The integration tests runs on Ubuntu so CLI works on Ubuntu too. If you find that works on different operating systems, let us know.</p><p>To use Aggregator you need three things:</p><ul><li>Access to an Azure DevOps Services Organization (or at least a Project)</li><li>a Personal Access Token with sufficient permissions on the Organization or Project</li><li>Access to an Azure Subscription (or at least a Resource Group)</li><li>a Service Principal with, at least, Contributor permission on a Resource Group of the Subscription</li><li><a href=https://dotnet.microsoft.com/download/dotnet-core/3.1>.Net Core 3.1</a> runtime installed on the machine where you run Aggregator CLI</li></ul><p>Aggregator uses a Service Principal (SP) to interact with Azure. For testing you can grant the SP powerful permissions; in a production scenario, is more typical to create one or more Azure Resource Groups and grant the SP permission to those.
In addition Aggregator uses an Azure DevOps Personal Access Token (PAT) to create the event subscriptions and interact with object in the target Azure DevOps Project. See <a href=../azdo-authn/>here</a> about the PAT.</p><p>Production configuration has some additional caveats listed <a href=../production/>here</a>.</p><h2 id=how-to-create-an-azure-service-principal>How to create an Azure Service Principal
<a class=anchor href=#how-to-create-an-azure-service-principal>#</a></h2><p>The below instructions are based on <a href=https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-create-service-principal-portal>Use portal to create an Azure Active Directory application and service principal that can access resources</a>.</p><p>If you do not have Contributor or Owner permission to the Azure Subscription, ask your administrator to do the instructions that follow.</p><p>To create an Azure Service Principal you can <a href="https://docs.microsoft.com/en-us/powershell/azure/create-azure-service-principal-azureps?view=azps-2.4.0">use Azure Powershell</a> or <a href="https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli?view=azure-cli-latest">Azure CLI</a>.
Shortly, run this Azure CLI command:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>az ad sp create-for-rbac --name AggregatorServicePrincipal
</code></pre></div><p>when successful, it outputs something similar</p><pre><code>{
  &quot;appId&quot;: &quot;12345678-90ab-cdef-1234-567890abcedf&quot;,
  &quot;displayName&quot;: &quot;AggregatorServicePrincipal&quot;,
  &quot;name&quot;: &quot;http://AggregatorServicePrincipal&quot;,
  &quot;password&quot;: &quot;23456789-0abc-def1-2345-67890abcdef1&quot;,
  &quot;tenant&quot;: &quot;34567890-abcd-ef12-3456-7890abcedf12&quot;
}
</code></pre><p>take note of this information and keep it in a safe place. If you prefer a different password you can force a new one with a similar command:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>az ad app credential reset --id 12345678-90ab-cdef-1234-567890abcedf --append --password P@ssw0rd!
</code></pre></div><blockquote class="book-hint info">The GUIDs in this section are completely made up. Expect different values when you run the commands.</blockquote><h3 id=assign-permissions-to-service-principal>Assign permissions to Service Principal
<a class=anchor href=#assign-permissions-to-service-principal>#</a></h3><p>The Service Principal must have Contributor permission to the Azure Subscription or, in alternative, pre-create the Resource Group in Azure and give the service account Contributor permission to the Resource Group.</p><p><img src=contributor-on-rg.png alt="Permission on existing Resource Group"></p><p>This example creates a Resource Group and gives permission to the Service Principal created in the previous example.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># create Resource Group with permission to Service Principal</span>
az group create --name aggregator-cli-demo --location westeurope
az role assignment create --role Contributor --assignee 12345678-90ab-cdef-1234-567890abcedf --resource-group aggregator-cli-demo
</code></pre></div><p>In Azure Portal you can check the permissions in the IAM menu for the selected Resource Group</p><p><img src=contributor-on-rg.png alt="Permission on existing Resource Group"></p><h2 id=azure-devops-personal-access-token-pat>Azure DevOps Personal Access Token (PAT)
<a class=anchor href=#azure-devops-personal-access-token-pat>#</a></h2><p>See <a href=../azdo-authn/></a></p><h2 id=get-the-executable>Get the executable
<a class=anchor href=#get-the-executable>#</a></h2><p>Finally to run Aggregator CLI, download the latest <code>aggregator-cli*.zip</code> file from GitHub <a href=https://github.com/tfsaggregator/aggregator-cli/releases>Releases</a>. Select the file appropriate for your platform and unzip it in a convenient location.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/commit/a60075892725bb6571714924424b856bb5566830 title="Last modified by Jesse Houwing | August 10, 2022" target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/calendar.svg class=book-icon alt=Calendar>
<span>August 10, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/edit/master/content//docs/v3/setup/azure/_index.md target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#how-to-create-an-azure-service-principal>How to create an Azure Service Principal</a><ul><li><a href=#assign-permissions-to-service-principal>Assign permissions to Service Principal</a></li></ul></li><li><a href=#azure-devops-personal-access-token-pat>Azure DevOps Personal Access Token (PAT)</a></li><li><a href=#get-the-executable>Get the executable</a></li></ul></nav></aside></main></body></html>