<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Production Configuration and Administration of Azure Functions #  Renew Azure DevOps Personal Access Token (PAT) #  Azure DevOps Personal Access Token (PAT) expires and is up to the administrator to renew or replace them. Aggregator stores the PAT in the Azure Function configuration, allowing the rules to access Azure DevOps. You should refresh the PAT before expires or save a new PAT in Aggregator configuration using the configure.instance command."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Production on Azure"><meta property="og:description" content="Aggregator Documentation"><meta property="og:type" content="website"><meta property="og:url" content="https://tfsaggregator.github.io/docs/v3/setup/production/"><title>Production on Azure | Aggregator</title><link rel=manifest href=https://tfsaggregator.github.io/manifest.json><link rel=icon href=https://tfsaggregator.github.io/favicon.png type=image/x-icon><link rel=stylesheet href=https://tfsaggregator.github.io/book.min.b3215d9d1d18d9051e7fbe8f256ff80e30f41d29073b86348e230d297b771002.css integrity="sha256-syFdnR0Y2QUef76PJW/4DjD0HSkHO4Y0jiMNKXt3EAI="><script defer src=https://tfsaggregator.github.io/en.search.min.6b0c0810f944b5aabd6ed910dbc5fc8b635bcd388c47fb0efd899da47c849819.js integrity="sha256-awwIEPlEtaq9btkQ28X8i2NbzTiMR/sO/YmdpHyEmBk="></script><link rel=alternate type=application/rss+xml href=https://tfsaggregator.github.io/docs/v3/setup/production/index.xml title=Aggregator></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=https://tfsaggregator.github.io/><span>Aggregator</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://tfsaggregator.github.io/docs/v3/>Aggregator 3 (CLI)</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/>Setup</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/azdo-authn/>Azure DevOps Personal Access Token</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/azure/>Azure CLI Setup</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/docker/>Docker configuration</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/setup/production/ class=active>Production on Azure</a><ul></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/>CLI Commands</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/commands/common-options/>Common options</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/authentication-commands/>Authentication commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/instance-commands/>Instance commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/rule-commands/>Rule commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/map-commands/>Mapping commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/info-commands/>Informational commands</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/command-examples/>Examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/>Rules</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/rules/directives/>Directives</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/workitem/>WorkItem event objects</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/common-rule-objects/>Common objects</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-basic/>Basic examples</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-advanced/>Advanced examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/design/>Design</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/design/caveat/>Caveats</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/design/parallelism/>Parallelism</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/api/>REST API</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/troubleshoot/>Troubleshoot</a><ul></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/contrib/>Contribute</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/contrib/pipelines/>Pipelines</a></li></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v2/>TFS Aggregator v2</a><ul><li><a href=https://tfsaggregator.github.io/docs/v2/intro/ class=collapsed>Introduction</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/ class=collapsed>Users' Guide</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/ class=collapsed>Administrator Guide</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/contrib/ class=collapsed>Contributing</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/changelog/>Changelog</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://tfsaggregator.github.io/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Production on Azure</strong>
<label for=toc-control><img src=https://tfsaggregator.github.io/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#renew-azure-devops-personal-access-token-pat>Renew Azure DevOps Personal Access Token (PAT)</a></li><li><a href=#control-azure-performance-and-costs>Control Azure performance and costs</a></li><li><a href=#azure-production-monitoring>Azure Production monitoring</a></li><li><a href=#azure-troubleshooting>Azure Troubleshooting</a></li></ul></nav></aside></header><article class=markdown><h1 id=production-configuration-and-administration-of-azure-functions>Production Configuration and Administration of Azure Functions
<a class=anchor href=#production-configuration-and-administration-of-azure-functions>#</a></h1><h2 id=renew-azure-devops-personal-access-token-pat>Renew Azure DevOps Personal Access Token (PAT)
<a class=anchor href=#renew-azure-devops-personal-access-token-pat>#</a></h2><p>Azure DevOps Personal Access Token (PAT) expires and is up to the administrator to renew or replace them.
Aggregator stores the PAT in the Azure Function configuration, allowing the rules to access Azure DevOps. You should refresh the PAT before expires or save a new PAT in Aggregator configuration using the <code>configure.instance</code> command.</p><p><img src=PAT-token-in-Function-configuration.png alt="PAT token saved in Azure Function configuration"></p><h2 id=control-azure-performance-and-costs>Control Azure performance and costs
<a class=anchor href=#control-azure-performance-and-costs>#</a></h2><p>You can specify the size for the Virtual machine running the rules using the <code>hostingPlanSku</code> and <code>hostingPlanTier</code> options. The defaults are <strong>Y1</strong>/<strong>Dynamic</strong>, known as <a href=https://docs.microsoft.com/en-us/azure/azure-functions/functions-scale#consumption-plan>Consumption plan</a>. You can select a <a href=https://docs.microsoft.com/en-us/azure/azure-functions/functions-scale#premium-plan>Premium plan</a> instead, like <strong>Premium</strong>/<strong>P2V2</strong> for example.</p><h2 id=azure-production-monitoring>Azure Production monitoring
<a class=anchor href=#azure-production-monitoring>#</a></h2><p><a href=https://docs.microsoft.com/en-us/azure/azure-functions/functions-monitoring#disable-built-in-logging>Disable built-in logging</a> and use Application Insights.
Build-in log streaming is useful only for developers as it may skip or duplicate messages as in this picture.
<img src=basic-log-streaming.png alt="Duplicated log streaming message"></p><h2 id=azure-troubleshooting>Azure Troubleshooting
<a class=anchor href=#azure-troubleshooting>#</a></h2><p>For limited testing you can use the stream command: it connects for 30 minutes to the Azure Application and prints the logging messages.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Batchfile data-lang=Batchfile>stream.logs --instance my7 --resourceGroup test-aggregator7 --verbose
</code></pre></div><p>You can stop the program using <code>Ctrl+C</code> keystroke or closing the command window.</p><p>The traces generated by the Aggregator Rule Engine are sent to the Application Insight instance that was created aside the Azure Function.
More information on Application Insights can be found in <a href=https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview>Azure documentation</a>.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/commit/73154e9d6ce35c15dbe3ce9b1da2f106309c4a34 title="Last modified by Jesse Houwing | August 10, 2022" target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/calendar.svg class=book-icon alt=Calendar>
<span>August 10, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/edit/master/content//docs/v3/setup/production/_index.md target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#renew-azure-devops-personal-access-token-pat>Renew Azure DevOps Personal Access Token (PAT)</a></li><li><a href=#control-azure-performance-and-costs>Control Azure performance and costs</a></li><li><a href=#azure-production-monitoring>Azure Production monitoring</a></li><li><a href=#azure-troubleshooting>Azure Troubleshooting</a></li></ul></nav></aside></main></body></html>