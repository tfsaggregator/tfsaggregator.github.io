<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Aggregator CLI #  This is the successor to renowned TFS Aggregator. The current Server Plugin version (2.x) will be maintained to support TFS. The Web Service flavour will be discontinued in favour of this new tool for two reasons:
 deployment and configuration of Web Service was too complex for most users; both the Plugin and the Service rely heavily on TFS Object Model which is deprecated.  The main scenario for Aggregator (3."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Aggregator CLI"><meta property="og:description" content="Aggregator Documentation"><meta property="og:type" content="website"><meta property="og:url" content="https://tfsaggregator.github.io/docs/v3/"><title>Aggregator CLI | Aggregator</title><link rel=manifest href=https://tfsaggregator.github.io/manifest.json><link rel=icon href=https://tfsaggregator.github.io/favicon.png type=image/x-icon><link rel=stylesheet href=https://tfsaggregator.github.io/book.min.b3215d9d1d18d9051e7fbe8f256ff80e30f41d29073b86348e230d297b771002.css integrity="sha256-syFdnR0Y2QUef76PJW/4DjD0HSkHO4Y0jiMNKXt3EAI="><script defer src=https://tfsaggregator.github.io/en.search.min.0fd7b9ca417654d7c89b5e26f6d9398920826afc007e965e91d8decea0bb3cd6.js integrity="sha256-D9e5ykF2VNfIm14m9tk5iSCCavwAfpZekdjezqC7PNY="></script><link rel=alternate type=application/rss+xml href=https://tfsaggregator.github.io/docs/v3/index.xml title=Aggregator></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=https://tfsaggregator.github.io/><span>Aggregator</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://tfsaggregator.github.io/docs/v3/ class=active>Aggregator CLI</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/>Setup</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/setup/production/>Production</a><ul></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/commands/>Commands</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/commands/command-examples/>Examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/>Rules</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-basic/>Basic examples</a></li><li><a href=https://tfsaggregator.github.io/docs/v3/rules/rule-examples-advanced/>Advanced examples</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/design/>Design</a><ul><li><a href=https://tfsaggregator.github.io/docs/v3/design/parallelism/>Parallelism</a></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v3/contrib/>Contribute</a><ul></ul></li></ul></li><li><a href=https://tfsaggregator.github.io/docs/v2/>TFS Aggregator v2</a><ul><li><a href=https://tfsaggregator.github.io/docs/v2/intro/ class=collapsed>Introduction</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/using/ class=collapsed>Users' Guide</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/admin/ class=collapsed>Administrator Guide</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/contrib/ class=collapsed>Contributing</a></li><li><a href=https://tfsaggregator.github.io/docs/v2/changelog/>Changelog</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://tfsaggregator.github.io/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Aggregator CLI</strong>
<label for=toc-control><img src=https://tfsaggregator.github.io/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#major-features>Major features</a></li><li><a href=#requirements>Requirements</a></li><li><a href=#how-it-works>How it works</a></li><li><a href=#authentication>Authentication</a></li><li><a href=#usage>Usage</a><ul><li><a href=#verbs>Verbs</a></li></ul></li><li><a href=#rule-language>Rule language</a></li><li><a href=#maintenance>Maintenance</a></li><li><a href=#troubleshooting>Troubleshooting</a></li></ul></nav></aside></header><article class=markdown><h1 id=aggregator-cli>Aggregator CLI
<a class=anchor href=#aggregator-cli>#</a></h1><p>This is the successor to renowned TFS Aggregator.
The current Server Plugin version (2.x) will be maintained to support TFS.
The Web Service flavour will be discontinued in favour of this new tool for two reasons:</p><ul><li>deployment and configuration of Web Service was too complex for most users;</li><li>both the Plugin and the Service rely heavily on TFS Object Model which is <a href=https://docs.microsoft.com/en-us/azure/devops/integrate/concepts/wit-client-om-deprecation>deprecated</a>.</li></ul><p>The main scenario for Aggregator (3.x) is to support Azure DevOps Services and Azure. In the future, we might support the on-premise scenario to permit replacement of the Server Plugin.</p><h2 id=major-features>Major features
<a class=anchor href=#major-features>#</a></h2><ul><li>use of new Azure DevOps REST API</li><li>simple deployment via CLI tool</li><li>Rule object model similar to TFS Aggregator v2</li></ul><h2 id=requirements>Requirements
<a class=anchor href=#requirements>#</a></h2><ul><li>an Azure DevOps Services Project</li><li>a Personal Access Token with sufficient permissions on the Project</li><li>an Azure Subscription</li><li>a Service Principal with, at least, Contributor permission on a Resource Group of the Subscription</li><li>basic knowledge of C# language, Azure Boards and Azure</li></ul><h2 id=how-it-works>How it works
<a class=anchor href=#how-it-works>#</a></h2><p>As the name implies, this is a command line tool: you download the latest aggregator-cli*.zip appropriate for your platform from GitHub <a href=https://github.com/tfsaggregator/aggregator-cli/releases>releases</a> and unzip it on your client machine.
Read more below in the <a href=#usage>Usage</a> section.</p><p>Through the CLI you create one or more Azure Functions in your Subscription. The Functions use a library named Aggregator <strong>Runtime</strong> to run your <strong>Rules</strong>.
A Rule is code that reacts to one or more Azure DevOps event; currently, the only language for writing rules is C#.</p><p>The CLI automatically checks GitHub Releases to ensure that you use the more recent version of Aggregator Runtime available. To avoid automatic upgrades, specify the Runtime version or point to a specific Runtime package file, using an <code>http:</code> or <code>file:</code> URL.</p><p>After you setup the Rules in Azure, you must add at least one <strong>Mapping</strong>. A mapping is an Azure DevOps Service Hook that send a message to the Azure Function when a specific event occurs. Currently we support only Work Item events.
When triggered, the Azure DevOps Service Hook invokes a single Aggregator Rule i.e. the Azure Function hosting the Rule code. Azure DevOps saves the Azure Function Key in the Service Hook configuration.</p><p>You can deploy the same Rule in different Instances, map the same Azure DevOps event to many Rules or map multiple events to the same Rule: you choose the best way to organize your code.</p><h2 id=authentication>Authentication
<a class=anchor href=#authentication>#</a></h2><p>You must instruct Aggregator which credential to use.
To do this, run the <code>login.azure</code> and <code>login.ado</code> commands.</p><p>To create the credentials, you need an Azure Service Principal and a Azure DevOps Personal Access Token. Full details in the <a href=setup/>Setup</a> section.</p><p>Aggregator stores the logon credentials locally and expires them after 2 hours.</p><p>The PAT is also stored in the Azure Function settings: <strong>whoever has access to the Resource Group can read it!</strong></p><p>The Service Principal must have Contributor permission to the Azure Subscription or, in alternative, pre-create the Resource Group in Azure and give the service account Contributor permission to the Resource Group.
<img src=setup/contributor-on-rg.png alt="Permission on existing Resource Group">
If you go this route, remember add the <code>--resourceGroup</code> to all commands requiring an instance.</p><h2 id=usage>Usage
<a class=anchor href=#usage>#</a></h2><p>Download and unzip the latest CLI.zip file from <a href=https://github.com/tfsaggregator/aggregator-cli/releases>Releases</a>.
It requires <a href=https://dotnet.microsoft.com/download/dotnet-core/3.1>.Net Core 3.1</a> installed on the machine.
To run Aggregator run <code>aggregator-cli.exe</code> (Windows), <code>aggregator-cli</code> (Linux) or <code>dotnet aggregator-cli.dll</code> followed by a verb and its options.</p><h3 id=verbs>Verbs
<a class=anchor href=#verbs>#</a></h3><table><thead><tr><th>Verb</th><th>Use</th></tr></thead><tbody><tr><td>logon.azure</td><td>Logon into Azure. This must be done before other verbs.</td></tr><tr><td>logon.ado</td><td>Logon into Azure DevOps. This must be done before other verbs.</td></tr><tr><td>install.instance</td><td>Creates a new Aggregator instance in Azure.</td></tr><tr><td>add.rule</td><td>Add a rule to existing Aggregator instance in Azure.</td></tr><tr><td>map.rule</td><td>Maps an Aggregator Rule to existing Azure DevOps Projects, DevOps events are sent to the rule.</td></tr><tr><td>list.instances</td><td>Lists Aggregator instances in the specified Azure Region or Resource Group or in the entire Subscription.</td></tr><tr><td>list.rules</td><td>List the rules in an existing Aggregator instance in Azure.</td></tr><tr><td>list.mappings</td><td>Lists mappings from existing Azure DevOps Projects to Aggregator Rules.</td></tr><tr><td>invoke.rule</td><td>Executes a rule locally or in an existing Aggregator instance.</td></tr><tr><td>configure.instance</td><td>Configures an existing Aggregator instance (currently the Azure DevOps authentication).</td></tr><tr><td>configure.rule</td><td>Change a rule configuration (currently only enabling/disabling).</td></tr><tr><td>update.rule</td><td>Update the code of a rule and/or its runtime.</td></tr><tr><td>unmap.rule</td><td>Unmaps an Aggregator Rule from a Azure DevOps Project.</td></tr><tr><td>remove.rule</td><td>Remove a rule from existing Aggregator instance in Azure, removing any mapping to the Rule.</td></tr><tr><td>uninstall.instance</td><td>Destroy an Aggregator instance in Azure, removing any mapping to the Rules.</td></tr><tr><td>help</td><td>Display more information on a specific command.</td></tr><tr><td>version</td><td>Display version information.</td></tr></tbody></table><p>See <a href=commands/>Commands</a> for further details.</p><h2 id=rule-language>Rule language
<a class=anchor href=#rule-language>#</a></h2><p>See <a href=rules/>Rule Language</a> for a list of objects and properties to use.
For examples see <a href=rules/rule-examples-basic/>Rule Examples</a>.</p><h2 id=maintenance>Maintenance
<a class=anchor href=#maintenance>#</a></h2><p>Aggregator stores the PAT in the Azure Function configuration. Before the PAT expire you should refresh it from Azure DevOps or save a new PAT using the <code>configure.instance</code> command.</p><p>Read <a href=setup/production/>Production Configuration and Administration</a> for recommendations on running Aggregator in production.</p><h2 id=troubleshooting>Troubleshooting
<a class=anchor href=#troubleshooting>#</a></h2><p>Use the Application Insight instance that was created aside the Azure Function.
Details on building your own version and testing are in the <a href=contrib/>Contribute</a> section.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/commit/59b03b4bd9444633c4cab890366a82833bb98f40 title="Last modified by Giulio Vian | July 11, 2020" target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/calendar.svg class=book-icon alt=Calendar>
<span>July 11, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/tfsaggregator/tfsaggregator-docs-hugo/edit/master/content//docs/v3/_index.md target=_blank rel=noopener><img src=https://tfsaggregator.github.io/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#major-features>Major features</a></li><li><a href=#requirements>Requirements</a></li><li><a href=#how-it-works>How it works</a></li><li><a href=#authentication>Authentication</a></li><li><a href=#usage>Usage</a><ul><li><a href=#verbs>Verbs</a></li></ul></li><li><a href=#rule-language>Rule language</a></li><li><a href=#maintenance>Maintenance</a></li><li><a href=#troubleshooting>Troubleshooting</a></li></ul></nav></aside></main></body></html>