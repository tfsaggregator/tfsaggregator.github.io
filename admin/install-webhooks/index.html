<!DOCTYPE html>
<html lang="en-us" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.18.1" />
    <meta name="description" content="TFS Aggregator Documentation">
<meta name="author" content="TFS Aggregator Team">

    <link rel="shortcut icon" href="https://tfsaggregator.github.io/images/favicon.png" type="image/x-icon" />

    
    <title>Installing the Web Service</title>
    <link href="https://tfsaggregator.github.io//css/nucleus.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/font-awesome.min.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/hybrid.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/featherlight.min.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/horsey.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/theme.css" rel="stylesheet">
    <link href="https://tfsaggregator.github.io//css/hugo-theme.css" rel="stylesheet">
    <script src="https://tfsaggregator.github.io//js/jquery-2.x.min.js"></script>
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    

  </head>
  <body class="" data-url="/admin/install-webhooks/">
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <table style="border: none">
  <tr>
<td style="border: none">
<a id="logo" href="https://tfsaggregator.github.io/">
  <svg width="64pt" height="64pt" viewBox="0 0 256 256" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path fill="#67217a" d=" M 0.00 0.00 L 256.00 0.00 L 256.00 256.00 L 0.00 256.00 L 0.00 0.00 Z" />
  <path fill="#ffffff" d=" M 17.06 22.33 C 64.21 22.35 111.36 22.26 158.51 22.37 C 158.55 35.94 158.57 49.51 158.49 63.08 C 132.37 63.47 106.23 63.07 80.10 63.28 C 82.26 66.12 84.60 68.83 87.05 71.42 C 91.26 70.04 94.98 67.51 99.22 66.25 C 101.06 65.50 102.60 67.10 104.05 67.98 C 115.48 76.67 126.96 85.29 138.59 93.70 C 158.53 73.23 178.15 52.46 198.09 32.00 C 214.00 38.19 229.79 44.69 245.68 50.96 C 245.08 96.98 245.80 143.03 245.31 189.05 C 229.48 195.67 213.45 201.86 197.42 208.00 C 182.35 191.95 166.51 176.63 151.13 160.86 C 147.11 156.87 143.34 152.62 139.07 148.88 C 126.48 157.93 114.29 167.53 101.77 176.69 C 97.62 174.24 93.52 171.67 89.09 169.75 C 84.11 175.31 79.28 181.03 75.20 187.28 C 103.49 187.49 131.78 187.24 160.07 187.41 C 160.33 200.92 160.43 214.43 160.32 227.95 C 111.80 228.05 63.27 228.03 14.75 227.96 C 14.67 217.29 14.69 206.62 14.73 195.96 C 14.57 194.50 15.33 193.27 16.22 192.22 C 28.37 177.36 40.40 162.41 52.52 147.54 C 59.10 138.87 66.55 130.88 72.85 122.00 C 68.63 116.03 63.47 110.81 58.78 105.22 C 45.32 89.38 31.70 73.67 18.17 57.89 C 16.64 56.35 17.09 54.03 16.97 52.07 C 17.08 42.16 16.90 32.24 17.06 22.33 Z" />
  <path fill="#67217a" d=" M 24.90 30.93 C 67.15 30.90 109.40 30.76 151.65 31.00 C 151.68 38.75 151.69 46.51 151.65 54.26 C 121.70 54.50 91.74 54.23 61.79 54.39 C 70.37 64.79 79.23 74.97 88.07 85.14 C 93.20 83.35 97.74 80.27 102.78 78.28 C 114.68 87.58 126.41 97.13 138.64 105.98 C 157.56 87.44 175.94 68.33 195.00 49.92 C 206.84 54.51 218.61 59.27 230.37 64.06 C 230.43 101.98 230.50 139.90 230.34 177.82 C 219.78 182.24 209.08 186.30 198.51 190.70 C 196.92 191.24 194.69 192.47 193.43 190.68 C 175.17 172.40 156.94 154.09 138.63 135.88 C 126.38 144.79 114.64 154.38 102.66 163.65 C 97.99 161.68 93.69 158.93 89.00 157.05 C 87.45 157.70 86.56 159.27 85.44 160.45 C 75.66 172.62 65.70 184.64 55.93 196.81 C 88.46 197.08 121.00 196.63 153.53 197.04 C 153.55 204.68 153.55 212.33 153.53 219.98 C 109.78 220.29 66.01 220.15 22.26 220.05 C 22.21 214.68 22.21 209.30 22.20 203.93 C 22.28 202.33 22.04 200.50 23.30 199.28 C 43.25 174.88 63.09 150.38 83.04 125.97 C 83.99 124.77 84.88 123.53 85.77 122.28 C 67.61 100.77 49.17 79.49 30.93 58.04 C 28.97 55.65 26.59 53.53 25.09 50.80 C 24.50 44.20 24.95 37.55 24.90 30.93 Z" />
  <path fill="#ffffff" d=" M 157.63 120.97 C 169.84 111.17 182.27 101.63 194.68 92.07 C 194.73 111.34 194.75 130.61 194.67 149.88 C 182.33 140.23 169.87 130.73 157.63 120.97 Z" />
  <path fill="#ffffff" d=" M 102.11 100.26 C 105.75 102.38 108.43 105.69 111.41 108.59 C 115.46 112.73 119.70 116.68 123.61 120.96 C 119.83 125.06 115.77 128.89 111.86 132.87 C 108.73 135.96 105.82 139.35 102.10 141.77 C 102.76 139.96 103.55 138.19 104.78 136.69 C 109.18 131.18 113.80 125.86 118.09 120.26 C 112.85 113.54 106.10 107.85 102.11 100.26 Z" />
  </svg>
</a>
</td>
    <td style="border: none; text-align: left">
<div style="font-weight: 300">
  TFS Aggregator
</div>
    </td>
</tr>
</table>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input id="search-by" type="text" placeholder="Search">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="https://tfsaggregator.github.io//js/lunr.min.js"></script>
<script type="text/javascript" src="https://tfsaggregator.github.io//js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "https:\/\/tfsaggregator.github.io\/";
</script>
<script type="text/javascript" src="https://tfsaggregator.github.io//js/search.js"></script>

    
</div>


  <div class="highlightable">
    <ul class="topics">
      
      
        
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
      
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/intro/">
        <a href="https://tfsaggregator.github.io/intro/">
          <span>
            
              <b>1. </b>
            
             Introduction
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/intro/how-it-works/">
              <a href="https://tfsaggregator.github.io/intro/how-it-works/">
                <span>
                  
                  How it Works     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/intro/slack-coc/">
              <a href="https://tfsaggregator.github.io/intro/slack-coc/">
                <span>
                  
                  Code of Conduct     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/using/">
        <a href="https://tfsaggregator.github.io/using/">
          <span>
            
              <b>2. </b>
            
             Users&#39; Guide
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/using/writing-rules/writing-rules/">
              <a href="https://tfsaggregator.github.io/using/writing-rules/writing-rules/">
                <span>
                  
                  Writing Rules and Policies     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/policy-syntax/">
              <a href="https://tfsaggregator.github.io/using/policy-syntax/">
                <span>
                  
                  Configuration XML syntax     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/scripting/">
              <a href="https://tfsaggregator.github.io/using/scripting/">
                <span>
                  
                  Scripting the Rules     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/object-model/">
              <a href="https://tfsaggregator.github.io/using/object-model/">
                <span>
                  
                  Objects Reference     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/objects-reference/self-object/">
              <a href="https://tfsaggregator.github.io/using/objects-reference/self-object/">
                <span>
                  
                    -&nbsp;
                  
                  self Object     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/objects-reference/field-object/">
              <a href="https://tfsaggregator.github.io/using/objects-reference/field-object/">
                <span>
                  
                    -&nbsp;
                  
                  Field Object     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/objects-reference/store-object/">
              <a href="https://tfsaggregator.github.io/using/objects-reference/store-object/">
                <span>
                  
                    -&nbsp;
                  
                  store Object     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/objects-reference/logger-object/">
              <a href="https://tfsaggregator.github.io/using/objects-reference/logger-object/">
                <span>
                  
                    -&nbsp;
                  
                  logger Object     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/objects-reference/library-objects/">
              <a href="https://tfsaggregator.github.io/using/objects-reference/library-objects/">
                <span>
                  
                    -&nbsp;
                  
                  Library Objects     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/policy-examples/">
              <a href="https://tfsaggregator.github.io/using/policy-examples/">
                <span>
                  
                  Examples of Policies     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/examples/auto-open-auto-close/">
              <a href="https://tfsaggregator.github.io/using/examples/auto-open-auto-close/">
                <span>
                  
                  Auto-Open and Auto-Close     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/examples/auto-create-children/">
              <a href="https://tfsaggregator.github.io/using/examples/auto-create-children/">
                <span>
                  
                  Auto-Create Children     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/scripting-tricks-n-tips/scripting-tricks-n-tips/">
              <a href="https://tfsaggregator.github.io/using/scripting-tricks-n-tips/scripting-tricks-n-tips/">
                <span>
                  
                  Tricks &amp; Tips     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/scripting-pitfalls/">
              <a href="https://tfsaggregator.github.io/using/scripting-pitfalls/">
                <span>
                  
                  Common Pitfalls     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/history-field/">
              <a href="https://tfsaggregator.github.io/using/history-field/">
                <span>
                  
                    -&nbsp;
                  
                  History field     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/using/upgrade-from-v1/">
              <a href="https://tfsaggregator.github.io/using/upgrade-from-v1/">
                <span>
                  
                  Upgrading from v1     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  parent" data-nav-id="/admin/">
        <a href="https://tfsaggregator.github.io/admin/">
          <span>
            
              <b>3. </b>
            
             Administrator Guide
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/admin/install/">
              <a href="https://tfsaggregator.github.io/admin/install/">
                <span>
                  
                  Installing the Server Plugin     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item active" data-nav-id="/admin/install-webhooks/">
              <a href="https://tfsaggregator.github.io/admin/install-webhooks/">
                <span>
                  
                  Installing the Web Service     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/admin/console-app/">
              <a href="https://tfsaggregator.github.io/admin/console-app/">
                <span>
                  
                  Using the console to test Policies     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/admin/troubleshooting/">
              <a href="https://tfsaggregator.github.io/admin/troubleshooting/">
                <span>
                  
                  Troubleshooting     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/admin/security/">
              <a href="https://tfsaggregator.github.io/admin/security/">
                <span>
                  
                  Security     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/contrib/">
        <a href="https://tfsaggregator.github.io/contrib/">
          <span>
            
              <b>4. </b>
            
             Contributing
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/contrib/developer-intro/">
              <a href="https://tfsaggregator.github.io/contrib/developer-intro/">
                <span>
                  
                  Introduction to Contributors     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/contrib/source-code/">
              <a href="https://tfsaggregator.github.io/contrib/source-code/">
                <span>
                  
                  Source Code     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/contrib/local-build/">
              <a href="https://tfsaggregator.github.io/contrib/local-build/">
                <span>
                  
                  Local Build     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/contrib/debugging/">
              <a href="https://tfsaggregator.github.io/contrib/debugging/">
                <span>
                  
                  Debugging     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/contrib/continuous-integration/">
              <a href="https://tfsaggregator.github.io/contrib/continuous-integration/">
                <span>
                  
                  Continuous Integration     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
    </ul>
    <hr>
     
     <section id="contacts">
  <div style="padding-left: 1em; ">
    <a href="mailto:tfsaggregator@outlook.com"><i class="fa fa-envelope">&nbsp;</i>tfsaggregator@outlook.com</a>
    <br/>
    <a href="https://twitter.com/tfsaggregator"><i class="fa fa-twitter">&nbsp;</i>@tfsaggregator</a>
    <br/>
    <div style="padding-top: 4pt;">
    <a href="https://slackin-tfsaggregator.herokuapp.com/">
      <img alt="Slack Team Badge" src="https://slackin-tfsaggregator.herokuapp.com/badge.svg" />
    </a>
    </div>
  </div>
</section>
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>
    </section>
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
                
                
                
              <div id="top-github-link">
                  <a class="github-link" href="https://github.com/tfsaggregator/tfsaggregator-docs-hugo/edit/master/content/admin/install-webhooks/index.md" target="blank">
                    <i class="fa fa-code-fork"></i>
                    Edit this page
                  </a>
              </div>
                
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                <span id="toc-menu"><a href=""><i class="fa fa-list-alt"></i></a></span>
                
                
                
                
                  
                
                  
                    
                    
                <a href="https://tfsaggregator.github.io/admin/" itemprop="url"><span itemprop="title">Administrator Guide</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                  
                
                  
                
                  
                
                <span itemprop="title"> Installing the Web Service</span>
              </div>
              
                  <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#grant-access-to-vsts-tfs">Grant access to VSTS/TFS</a>
<ul>
<li><a href="#1-using-a-personal-access-token">1. Using a Personal Access Token</a></li>
<li><a href="#2-tfs-only-account-permissions">2. [TFS only] Account permissions</a></li>
<li><a href="#3-tfs-only-explicit-credentials">3. [TFS only] Explicit credentials</a></li>
</ul></li>
<li><a href="#deploy-tfsaggregator-web-application">Deploy TfsAggregator web application</a>
<ul>
<li><a href="#1-tfs-only-install-on-iis">1. [TFS only] Install on IIS</a></li>
<li><a href="#2-deploy-to-azure">2. Deploy to Azure</a></li>
</ul></li>
<li><a href="#configure-tfs-aggregator">Configure TFS Aggregator</a>
<ul>
<li><a href="#add-users-to-web-config-file">Add users to <code>web.config</code> file</a></li>
<li><a href="#configure-the-policy-mapping">Configure the policy mapping</a></li>
</ul></li>
<li><a href="#define-the-policy">Define the policy</a>
<ul>
<li><a href="#specify-authentication-in-the-policy">Specify Authentication in the policy</a></li>
</ul></li>
<li><a href="#setup-logging-optional">Setup logging (optional)</a></li>
<li><a href="#setup-the-web-hooks-in-tfs-vsts">Setup the Web Hooks in TFS/VSTS</a>
<ul>
<li><a href="#using-powershell">Using Powershell</a></li>
<li><a href="#manual-configuration">Manual configuration</a></li>
</ul></li>
<li><a href="#final-testing">Final testing</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

              

            </div>
            
    	        <div id="body-inner">
                
                <h1>Installing the Web Service</h1>
                



<p>Installing TFS Aggregator Web Service is a six step process:</p>

<ol>
<li><a href="#grant-access-to-vststfs">Grant access to VSTS/TFS</a></li>
<li><a href="#deploy-tfsaggregator-webhooks-web-application">Deploy TfsAggregator web application</a></li>
<li><a href="#configure-tfs-aggregator">Configure TFS Aggregator</a></li>
<li><a href="#define-the-policy">Define the policy</a></li>
<li><a href="#setup-logging-optional">Setup logging (optional)</a></li>
<li><a href="#setup-the-web-hooks-in-tfsvsts">Setup the Web Hooks in TFS/VSTS</a></li>
</ol>

<h2 id="grant-access-to-vsts-tfs">Grant access to VSTS/TFS</h2>

<p>There are  three possible options to grant access. In most cases you will have to change the configuration later using the values collected in this step.</p>

<h3 id="1-using-a-personal-access-token">1. Using a Personal Access Token</h3>

<p>a. Create a Personal Access Token <img src="./0-PAT1.png" alt="Create Personal Access Token  screenshot" /></p>

<blockquote>
<p>Leave <strong>All scopes</strong> select; TFS Aggregator use the old Object Model (see <a href="https://social.msdn.microsoft.com/Forums/vstudio/en-US/5564cb2b-4e46-4a41-b12c-bc50304c777b/authentication-issue-using-personal-access-token-when-all-options-of-selected-scope-are-selected?forum=TFService">Authentication issue using Personal Access Token when all options of &ldquo;Selected Scope&rdquo; are selected</a>).</p>
</blockquote>

<p>b. Capture Personal Access Token&rsquo;s value and store it for later <img src="./0-PAT2.png" alt="Personal Access Token's value" /></p>

<blockquote>
<p>NOTE: this is per-account value you can use (User Profile/Security)</p>
</blockquote>

<h3 id="2-tfs-only-account-permissions">2. [TFS only] Account permissions</h3>

<p>instead of a PAT, you can give permission to the account running the Application Pool (see <a href="https://tfsaggregator.github.io/admin/troubleshooting/">Troubleshooting</a>)</p>

<h3 id="3-tfs-only-explicit-credentials">3. [TFS only] Explicit credentials</h3>

<p>or put username and password in clear text in the <code>/AggregatorConfiguration/runtime/authentication</code> node of the policy file</p>

<p>If you do not allow access expect a similar error
<img src="./0-error.png" alt="Access denied" /></p>

<h2 id="deploy-tfsaggregator-web-application">Deploy TfsAggregator web application</h2>

<h3 id="1-tfs-only-install-on-iis">1. [TFS only] Install on IIS</h3>

<p>To install TfsAggregator web application you can use the <code>Deploy-TfsAggregatorWebHooks.ps1</code> as a sample script</p>

<ul>
<li>use SSL to avoid exposing credentials</li>
<li>the account running Aggregator application pool must have proper permissions on the target TFS <em>or</em> you set some credentials in the policy file</li>
</ul>

<h3 id="2-deploy-to-azure">2. Deploy to Azure</h3>

<p>Use the <a href="https://azuredeploy.net/"><img src="http://azuredeploy.net/deploybutton.png" alt="Deploy to Azure" /></a> button.
This is the simplest option for VSTS.</p>

<p>In the wizard specify the</p>

<p><img src="./1-deploy1.png" alt="" /></p>

<p><img src="./1-deploy2.png" alt="" /></p>

<p><img src="./1-deploy3.png" alt="" /></p>

<p>Please take note of the URL for the next steps.</p>

<p>You can check that the deploy worked, by opening a browser to the above URL appending <code>/api/workitem</code></p>

<p><img src="./1-deploy4-validate.png" alt="" /></p>

<h2 id="configure-tfs-aggregator">Configure TFS Aggregator</h2>

<p>To edit the deployed files, use Kudu console</p>

<p><img src="./2-config1.png" alt="Kudu console" /></p>

<p>at the <code>https://</code><name_chosen_in_previous_step><code>.scm.azurewebsites.net</code> URL. Navigate to <code>site\wwwroot</code> folder via <strong>Debug console</strong> menu.</p>

<p><img src="./2-config2.png" alt="" /></p>

<h3 id="add-users-to-web-config-file">Add users to <code>web.config</code> file</h3>

<p>Add at least one user in the <code>Users</code> section</p>

<pre><code>  &lt;Users&gt;
    &lt;add key=&quot;vsts&quot; value=&quot;P@ssw0rd!&quot; /&gt;
  &lt;/Users&gt;
</code></pre>

<h3 id="configure-the-policy-mapping">Configure the policy mapping</h3>

<p>Define the <code>policyFilePath</code> in <code>web.config</code>; the default value is the static path of the sample policy.</p>

<p><img src="./2-config3.png" alt="" /></p>

<p>Instead of a static path you can use a variable value from the incoming request e.g. <code>&lt;add key=&quot;policyFilePath&quot; value=&quot;~/App_Data/{CollectionId}.policies&quot; /&gt;</code>.
The possible variables for <code>policyFilePath</code>, extracted from the incoming request data are:</p>

<ul>
<li><code>{EventType}</code> could be <code>workitem.created</code> <code>workitem.updated</code> <code>workitem.restored</code> or <code>workitem.deleted</code></li>
<li><code>{AccountId}</code> Guid of VSTS Account (TFS 2017 or later)</li>
<li><code>{CollectionId}</code> Guid of collection</li>
<li><code>{TeamProject}</code> name of the Team Project</li>
<li><code>{TfsCollectionUri}</code> URL of the collection</li>
</ul>

<h2 id="define-the-policy">Define the policy</h2>

<p>Navigate to the <code>App_Data</code> folder to edit the policy files</p>

<p><img src="./2-config4.png" alt="" /></p>

<blockquote>
<p>The default HelloWorld policy works for any kind of work items.</p>
</blockquote>

<h3 id="specify-authentication-in-the-policy">Specify Authentication in the policy</h3>

<p>The <code>runtime/authentication</code> element accept two new options</p>

<ol>
<li>Explicit credentials
<code>&lt;authentication username=&quot;DOMAIN\user&quot; password=&quot;***&quot; /&gt;</code>
not much secure, but handy for testing and some edge scenario</li>
<li>Personal Access Token (obtained on step 1)
<code>&lt;authentication personalToken=&quot;***&quot; /&gt;</code></li>
</ol>

<p>In the policies you may have to set the credentials chosen in the first step, e.g. the PAT.</p>

<p><img src="./2-config5.png" alt="Personal Access Token in Policy file" /></p>

<h2 id="setup-logging-optional">Setup logging (optional)</h2>

<p>This step is not mandatory, but recommended in the initial phase.</p>

<p>In the <a href="https://portal.azure.com/">Azure Portal</a> navigate to <strong>App Services</strong> and select the App Service hosting TFS Aggregator. Scroll down to <strong>Diagnostic logs</strong> and turn on <strong>Application Logging</strong>.</p>

<p><img src="./3-log1.png" alt="" /></p>

<p>Select the Verbosity level and save.</p>

<blockquote>
<p>You can store the logs in Azure storage for auditing.</p>
</blockquote>

<p>In the Kudu console navigate to the <code>LogFiles\Application</code> folder to find the log files produced by TFS Aggregator.</p>

<p><img src="./3-log2.png" alt="" /></p>

<p>By opening the file you see a snapshot of log file&rsquo;s content.</p>

<p><img src="./3-log3.png" alt="Content of a log file" /></p>

<h2 id="setup-the-web-hooks-in-tfs-vsts">Setup the Web Hooks in TFS/VSTS</h2>

<p>This is the last step: setup the caller, i.e. configure VSTS/TFS to invoke TFS Aggregator (see also <a href="https://www.visualstudio.com/en-us/docs/integrate/get-started/service-hooks/services/webhooks">Web Hooks</a>).</p>

<h3 id="using-powershell">Using Powershell</h3>

<p>In the <code>samples</code> folder you can find the <code>Create-Subscriptions.ps1</code> Powershell script to quickly setup the subscription.
It requires six arguments and creates the subcription for create, update and restore events.</p>

<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
<th>Sample value</th>
</tr>
</thead>

<tbody>
<tr>
<td>tfsURL</td>
<td>TFS/VSTS base URL</td>
<td><code>https://me.visualstudio.com/</code></td>
</tr>

<tr>
<td>ProjectName</td>
<td>TFS/VSTS project name</td>
<td><code>My Project</code></td>
</tr>

<tr>
<td>PersonalAccessToken</td>
<td>Personal Access Token generated in step 1</td>
<td><code>jocxco3i7twydcif25bh7yysbodwnq4ppuannhro4yryfcbab4na</code></td>
</tr>

<tr>
<td>aggregatorURL</td>
<td>URL of TFS Aggregator Web Service API</td>
<td><code>https://mytfsaggregator.azurewebsites.net/api/workitem/</code></td>
</tr>

<tr>
<td>aggregatorUsername</td>
<td>Username listed in TFS Aggregator Web Service <code>web.config</code></td>
<td><code>vsts</code></td>
</tr>

<tr>
<td>aggregatorPassword</td>
<td>Password for the above</td>
<td><code>P@ssw0rd!</code></td>
</tr>
</tbody>
</table>

<blockquote>
<p>The <code>workitem.deleted</code> fails with error <code>TF26198: The work item does not exist, or you do not have permission to access it.</code>
This is an issue with VSTS/TFS that we cannot solve.</p>
</blockquote>

<h3 id="manual-configuration">Manual configuration</h3>

<blockquote>
<p>NOTE: this is a per-project configuration (Project/Admin).</p>
</blockquote>

<p><img src="./4-hooks1.png" alt="" /></p>

<p><img src="./4-hooks2.png" alt="" /></p>

<p>Select <strong>Web Hooks</strong>
<img src="./4-hooks3.png" alt="" /></p>

<p>Select the triggering event
<img src="./4-hooks4.png" alt="" /></p>

<blockquote>
<p>You may have to repeat this step for all four event:</p>

<ul>
<li>New/created</li>
<li>Change/updated</li>
<li>Delete</li>
<li>Restore</li>
</ul>
</blockquote>

<p>Insert the URL, e.g. <code>https://</code><name_chosen_in_deploy_step><code>.azurewebsites.net/api/workitem</code> and one user listed in TFS Aggregator <code>web.config</code> file.</p>

<p><img src="./4-hooks5.png" alt="" /></p>

<blockquote>
<p>NOTE the <strong>Test</strong> button above may send a well-formed document or not, so to test if everything works you really must create/modify some work item.</p>
</blockquote>

<p>This is the result with a single hooked event.
<img src="./4-hooks6.png" alt="First service hook" /></p>

<p>And after all four events are defined.
<img src="./4-hooks7.png" alt="Four service hooks, one per event" /></p>

<h2 id="final-testing">Final testing</h2>

<p>At this point the configuration is complete and you can test, e.g. creating a new work item.</p>

<p><img src="./5-test1.png" alt="New Work Item" /></p>

<p>You see in the <strong>Service Hooks</strong> page</p>

<p><img src="./5-test2.png" alt="Service Hooks page after a few calls" /></p>

<p>the success or failure.
Remember that you can see the TFS Aggregator log to help troubleshooting.
<img src="./3-log3.png" alt="Content of a log file" /></p>


      
      </div>
          <div class="row">
          <div class="footer-panel">
<p>Last revision: January 12, 2017 | <a href="https://github.com/tfsaggregator/tfsaggregator-docs-hugo/commit/ae66422bd201a4d28b20bc78dc7e0b584181dceb">Fixed a number of errors in links to pictures and pages (ae66422)</a>
            <span style="float: right;">TFS Aggregator Documentation v2.3</span>
          </p>
          </div>
      </div>
    </div>

    <div id="navigation">
        
        <a class="nav nav-prev" href="https://tfsaggregator.github.io//admin/install"> <i class="fa fa-chevron-left"></i></a>
        <a class="nav nav-next" href="https://tfsaggregator.github.io//admin/console-app" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://tfsaggregator.github.io//js/clipboard.min.js"></script>
    <script src="https://tfsaggregator.github.io//js/perfect-scrollbar.min.js"></script>
    <script src="https://tfsaggregator.github.io//js/perfect-scrollbar.jquery.min.js"></script>
    <script src="https://tfsaggregator.github.io//js/jquery.sticky-kit.min.js"></script>
    <script src="https://tfsaggregator.github.io//js/featherlight.min.js"></script>
    <script src="https://tfsaggregator.github.io//js/html5shiv-printshiv.min.js"></script>
    <script src="https://tfsaggregator.github.io//js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://tfsaggregator.github.io//js/modernizr.custom.71422.js"></script>
    <script src="https://tfsaggregator.github.io//js/learn.js"></script>
    <script src="https://tfsaggregator.github.io//js/hugo-learn.js"></script>
    

  </body>
</html>

